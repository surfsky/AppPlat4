!function($){UMEDITOR_CONFIG=window.UMEDITOR_CONFIG||{},window.UM={plugins:{},commands:{},I18N:{},version:"1.2.2"};var dom=UM.dom={},browser=UM.browser=function(){var e=navigator.userAgent.toLowerCase(),t=window.opera,n={ie:/(msie\s|trident.*rv:)([\w.]+)/.test(e),opera:!!t&&t.version,webkit:-1<e.indexOf(" applewebkit/"),mac:-1<e.indexOf("macintosh"),quirks:"BackCompat"==document.compatMode};n.gecko="Gecko"==navigator.product&&!n.webkit&&!n.opera&&!n.ie;var i,o,r,a=0;return n.ie&&(i=e.match(/(?:msie\s([\w.]+))/),o=e.match(/(?:trident.*rv:([\w.]+))/),a=i&&o&&i[1]&&o[1]?Math.max(+i[1],+o[1]):i&&i[1]?+i[1]:o&&o[1]?+o[1]:0,n.ie11Compat=11==document.documentMode,n.ie9Compat=9==document.documentMode,n.ie8=!!document.documentMode,n.ie8Compat=8==document.documentMode,n.ie7Compat=7==a&&!document.documentMode||7==document.documentMode,n.ie6Compat=a<7||n.quirks,n.ie9above=8<a,n.ie9below=a<9),!n.gecko||(r=e.match(/rv:([\d\.]+)/))&&(a=1e4*(r=r[1].split("."))[0]+100*(r[1]||0)+ +(r[2]||0)),/chrome\/(\d+\.\d)/i.test(e)&&(n.chrome=+RegExp.$1),/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(e)&&!/chrome/i.test(e)&&(n.safari=+(RegExp.$1||RegExp.$2)),n.opera&&(a=parseFloat(t.version())),n.webkit&&(a=parseFloat(e.match(/ applewebkit\/(\d+)/)[1])),n.version=a,n.isCompatible=!n.mobile&&(n.ie&&6<=a||n.gecko&&10801<=a||n.opera&&9.5<=a||n.air&&1<=a||n.webkit&&522<=a||!1),n}(),ie=browser.ie,webkit=browser.webkit,gecko=browser.gecko,opera=browser.opera,utils=UM.utils={each:function(e,t,n){if(null!=e)if(e.length===+e.length){for(var i=0,o=e.length;i<o;i++)if(!1===t.call(n,e[i],i,e))return!1}else for(var r in e)if(e.hasOwnProperty(r)&&!1===t.call(n,e[r],r,e))return!1},makeInstance:function(e){var t=new Function;return t.prototype=e,e=new t,t.prototype=null,e},extend:function(e,t,n){if(t)for(var i in t)n&&e.hasOwnProperty(i)||(e[i]=t[i]);return e},extend2:function(e){for(var t=arguments,n=1;n<t.length;n++){var i,o=t[n];for(i in o)e.hasOwnProperty(i)||(e[i]=o[i])}return e},inherits:function(e,t){var n=e.prototype,i=utils.makeInstance(t.prototype);return utils.extend(i,n,!0),(e.prototype=i).constructor=e},bind:function(e,t){return function(){return e.apply(t,arguments)}},defer:function(e,t,n){var i;return function(){n&&clearTimeout(i),i=setTimeout(e,t)}},indexOf:function(e,n,i){var o=-1;return i=this.isNumber(i)?i:0,this.each(e,function(e,t){if(i<=t&&e===n)return o=t,!1}),o},removeItem:function(e,t){for(var n=0,i=e.length;n<i;n++)e[n]===t&&(e.splice(n,1),n--)},trim:function(e){return e.replace(/(^[ \t\n\r]+)|([ \t\n\r]+$)/g,"")},listToMap:function(e){if(!e)return{};e=utils.isArray(e)?e:e.split(",");for(var t,n=0,i={};t=e[n++];)i[t.toUpperCase()]=i[t]=1;return i},unhtml:function(e,t){return e?e.replace(t||/[&<">'](?:(amp|lt|quot|gt|#39|nbsp);)?/g,function(e,t){return t?e:{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;","'":"&#39;"}[e]}):""},html:function(e){return e?e.replace(/&((g|l|quo)t|amp|#39);/g,function(e){return{"&lt;":"<","&amp;":"&","&quot;":'"',"&gt;":">","&#39;":"'"}[e]}):""},cssStyleToDomStyle:(da=document.createElement("div").style,ea={float:null!=da.cssFloat?"cssFloat":null!=da.styleFloat?"styleFloat":"float"},function(e){return ea[e]||(ea[e]=e.toLowerCase().replace(/-./g,function(e){return e.charAt(1).toUpperCase()}))}),loadFile:(ha=[],function(t,n,e){var i=ia(t,n);if(i)i.ready?e&&e():i.funs.push(e);else if(ha.push({doc:t,url:n.src||n.href,funs:[e]}),t.body){if(!n.id||!t.getElementById(n.id)){var o=t.createElement(n.tag);for(r in delete n.tag,n)o.setAttribute(r,n[r]);o.onload=o.onreadystatechange=function(){if(!this.readyState||/loaded|complete/.test(this.readyState)){if(0<(i=ia(t,n)).funs.length){i.ready=1;for(var e;e=i.funs.pop();)e()}o.onload=o.onreadystatechange=null}},o.onerror=function(){throw Error("The load "+(n.href||n.src)+" fails,check the url settings of file umeditor.config.js ")},t.getElementsByTagName("head")[0].appendChild(o)}}else{var r,a=[];for(r in n)"tag"!=r&&a.push(r+'="'+n[r]+'"');t.write("<"+n.tag+" "+a.join(" ")+" ></"+n.tag+">")}}),isEmptyObject:function(e){if(null==e)return!0;if(this.isArray(e)||this.isString(e))return 0===e.length;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},fixColor:function(e,t){if(/color/i.test(e)&&/rgba?/.test(t)){var n=t.split(",");if(3<n.length)return"";t="#";for(var i,o=0;i=n[o++];)t+=1==(i=parseInt(i.replace(/[^\d]/gi,""),10).toString(16)).length?"0"+i:i;t=t.toUpperCase()}return t},clone:function(e,t){var n,i;for(i in t=t||{},e)e.hasOwnProperty(i)&&("object"==typeof(n=e[i])?(t[i]=utils.isArray(n)?[]:{},utils.clone(e[i],t[i])):t[i]=n);return t},transUnitToPx:function(i){if(!/(pt|cm)/.test(i))return i;var o;switch(i.replace(/([\d.]+)(\w+)/,function(e,t,n){i=t,o=n}),o){case"cm":i=25*parseFloat(i);break;case"pt":i=Math.round(96*parseFloat(i)/72)}return i+(i?"px":"")},cssRule:browser.ie&&11!=browser.version?function(e,t,n){var i,o,r;if((i=(n=n||document).indexList?n.indexList:n.indexList={})[e])r=n.styleSheets[i[e]];else{if(void 0===t)return"";r=n.createStyleSheet("",o=n.styleSheets.length),i[e]=o}if(void 0===t)return r.cssText;r.cssText=t||""}:function(e,t,n){var i,o=(n=n||document).getElementsByTagName("head")[0];if(!(i=n.getElementById(e))){if(void 0===t)return"";(i=n.createElement("style")).id=e,o.appendChild(i)}if(void 0===t)return i.innerHTML;""!==t?i.innerHTML=t:o.removeChild(i)}},ha,da,ea;function ia(e,t){try{for(var n,i=0;n=ha[i++];)if(n.doc===e&&n.url==(t.src||t.href))return n}catch(e){return null}}utils.each(["String","Function","Array","Number","RegExp","Object"],function(t){UM.utils["is"+t]=function(e){return Object.prototype.toString.apply(e)=="[object "+t+"]"}});var EventBase=UM.EventBase=function(){};function getListener(e,t,n){var i;return t=t.toLowerCase(),(i=e.__allListeners||n&&(e.__allListeners={}))&&(i[t]||n&&(i[t]=[]))}EventBase.prototype={addListener:function(e,t){e=utils.trim(e).split(" ");for(var n,i=0;n=e[i++];)getListener(this,n,!0).push(t)},removeListener:function(e,t){e=utils.trim(e).split(" ");for(var n,i=0;n=e[i++];)utils.removeItem(getListener(this,n)||[],t)},fireEvent:function(){for(var e,t=arguments[0],t=utils.trim(t).split(" "),n=0;e=t[n++];){var i,o,r,a=getListener(this,e);if(a)for(r=a.length;r--;)if(a[r]){if(!0===(o=a[r].apply(this,arguments)))return o;void 0!==o&&(i=o)}(o=this["on"+e.toLowerCase()])&&(i=o.apply(this,arguments))}return i}};var dtd=dom.dtd=(rb=utils.extend2,sb=qb({isindex:1,fieldset:1}),tb=qb({input:1,button:1,select:1,textarea:1,label:1}),ub=rb(qb({a:1}),tb),vb=rb({iframe:1},ub),wb=qb({hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1}),xb=qb({ins:1,del:1,script:1,style:1}),yb=rb(qb({b:1,acronym:1,bdo:1,var:1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1}),xb),zb=rb(qb({sub:1,img:1,embed:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1}),yb),Ab=rb(qb({p:1}),zb),Bb=rb(qb({iframe:1}),zb,tb),Cb=qb({img:1,embed:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,var:1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1}),Db=rb(qb({a:0}),Bb),Eb=qb({tr:1}),Fb=qb({"#":1}),Gb=rb(qb({param:1}),Cb),Hb=rb(qb({form:1}),sb,vb,wb,Ab),Ib=qb({li:1,ol:1,ul:1}),Jb=qb({style:1,script:1}),Kb=qb({base:1,link:1,meta:1,title:1}),Lb=rb(Kb,Jb),Mb=qb({head:1,body:1}),Nb=qb({html:1}),Ob=qb({address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1}),Pb=qb({area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1}),qb({$nonBodyContent:rb(Nb,Mb,Kb),$block:Ob,$inline:Db,$inlineWithA:rb(qb({a:1}),Db),$body:rb(qb({script:1,style:1}),Ob),$cdata:qb({script:1,style:1}),$empty:Pb,$nonChild:qb({iframe:1,textarea:1}),$listItem:qb({dd:1,dt:1,li:1}),$list:qb({ul:1,ol:1,dl:1}),$isNotEmpty:qb({table:1,ul:1,ol:1,dl:1,iframe:1,area:1,base:1,col:1,hr:1,img:1,embed:1,input:1,link:1,meta:1,param:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1}),$removeEmpty:qb({a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,var:1}),$removeEmptyBlock:qb({p:1,div:1}),$tableContent:qb({caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,table:1}),$notTransContent:qb({pre:1,script:1,style:1,textarea:1}),html:Mb,head:Lb,style:Fb,script:Fb,body:Hb,base:{},link:{},meta:{},title:Fb,col:{},tr:qb({td:1,th:1}),img:{},embed:{},colgroup:qb({thead:1,col:1,tbody:1,tr:1,tfoot:1}),noscript:Hb,td:Hb,br:{},th:Hb,center:Hb,kbd:Db,button:rb(Ab,wb),basefont:{},h5:Db,h4:Db,samp:Db,h6:Db,ol:Ib,h1:Db,h3:Db,option:Fb,h2:Db,form:rb(sb,vb,wb,Ab),select:qb({optgroup:1,option:1}),font:Db,ins:Db,menu:Ib,abbr:Db,label:Db,table:qb({thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1}),code:Db,tfoot:Eb,cite:Db,li:Hb,input:{},iframe:Hb,strong:Db,textarea:Fb,noframes:Hb,big:Db,small:Db,span:qb({"#":1,br:1,b:1,strong:1,u:1,i:1,em:1,sub:1,sup:1,strike:1,span:1}),hr:Db,dt:Db,sub:Db,optgroup:qb({option:1}),param:{},bdo:Db,var:Db,div:Hb,object:Gb,sup:Db,dd:Hb,strike:Db,area:{},dir:Ib,map:rb(qb({area:1,form:1,p:1}),sb,xb,wb),applet:Gb,dl:qb({dt:1,dd:1}),del:Db,isindex:{},fieldset:rb(qb({legend:1}),Cb),thead:Eb,ul:Ib,acronym:Db,b:Db,a:rb(qb({a:1}),Bb),blockquote:rb(qb({td:1,tr:1,tbody:1,li:1}),Hb),caption:Db,i:Db,u:Db,tbody:Eb,s:Db,address:rb(vb,Ab),tt:Db,legend:Db,q:Db,pre:rb(yb,ub),p:rb(qb({a:1}),Db),em:Db,dfn:Db})),rb,sb,tb,ub,vb,wb,xb,yb,zb,Ab,Bb,Cb,Db,Eb,Fb,Gb,Hb,Ib,Jb,Kb,Lb,Mb,Nb,Ob,Pb;function qb(e){for(var t in e)e[t.toUpperCase()]=e[t];return e}function getDomNode(e,t,n,i,o,r){for(var a,s=(s=i&&e[t])||e[n];!s&&(a=(a||e).parentNode);){if("BODY"==a.tagName||r&&!r(a))return null;s=a[n]}return s&&o&&!o(s)?getDomNode(s,t,n,!1,o):s}var attrFix=ie&&browser.version<9?{tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder"}:{tabindex:"tabIndex",readonly:"readOnly"},styleBlock=utils.listToMap(["-webkit-box","-moz-box","block","list-item","table","table-row-group","table-header-group","table-footer-group","table-row","table-column-group","table-column","table-cell","table-caption"]),domUtils=dom.domUtils={NODE_ELEMENT:1,NODE_DOCUMENT:9,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11,POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16,fillChar:ie&&"6"==browser.version?"\ufeff":"​",keys:{8:1,46:1,16:1,17:1,18:1,37:1,38:1,39:1,40:1,13:1},breakParent:function(e,t){var n,i,o,r=e,a=e;do{for(r=r.parentNode,o=i?((n=r.cloneNode(!1)).appendChild(i),i=n,(n=r.cloneNode(!1)).appendChild(o),n):(i=r.cloneNode(!1)).cloneNode(!1);n=a.previousSibling;)i.insertBefore(n,i.firstChild);for(;n=a.nextSibling;)o.appendChild(n);a=r}while(t!==r);return(n=t.parentNode).insertBefore(i,t),n.insertBefore(o,t),n.insertBefore(e,o),domUtils.remove(t),e},trimWhiteTextNode:function(n){function e(e){for(var t;(t=n[e])&&3==t.nodeType&&domUtils.isWhitespace(t);)n.removeChild(t)}e("firstChild"),e("lastChild")},getPosition:function(e,t){if(e===t)return 0;for(var n=[e],i=[t],o=e;o=o.parentNode;){if(o===t)return 10;n.push(o)}for(o=t;o=o.parentNode;){if(o===e)return 20;i.push(o)}if(n.reverse(),i.reverse(),n[0]!==i[0])return 1;for(var r=-1;n[++r]===i[r];);for(e=n[r],t=i[r];e=e.nextSibling;)if(e===t)return 4;return 2},getNodeIndex:function(e,t){for(var n=e,i=0;n=n.previousSibling;)(!t||3!=n.nodeType||n.nodeType!=n.nextSibling.nodeType)&&i++;return i},inDoc:function(e,t){return 10==domUtils.getPosition(e,t)},findParent:function(e,t,n){if(e&&!domUtils.isBody(e))for(e=n?e:e.parentNode;e;){if(!t||t(e)||domUtils.isBody(e))return t&&!t(e)&&domUtils.isBody(e)?null:e;e=e.parentNode}return null},findParentByTagName:function(e,t,n,i){return t=utils.listToMap(utils.isArray(t)?t:[t]),domUtils.findParent(e,function(e){return t[e.tagName]&&!(i&&i(e))},n)},findParents:function(e,t,n,i){for(var o=t&&(n&&n(e)||!n)?[e]:[];e=domUtils.findParent(e,n);)o.push(e);return i?o:o.reverse()},insertAfter:function(e,t){return e.parentNode.insertBefore(t,e.nextSibling)},remove:function(e,t){var n,i=e.parentNode;if(i){if(t&&e.hasChildNodes())for(;n=e.firstChild;)i.insertBefore(n,e);i.removeChild(e)}return e},getNextDomNode:function(e,t,n,i){return getDomNode(e,"firstChild","nextSibling",t,n,i)},getPreDomNode:function(e,t,n,i){return getDomNode(e,"lastChild","previousSibling",t,n,i)},isBookmarkNode:function(e){return 1==e.nodeType&&e.id&&/^_baidu_bookmark_/i.test(e.id)},getWindow:function(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow},getCommonAncestor:function(e,t){if(e===t)return e;for(var n=[e],i=[t],o=e,r=-1;o=o.parentNode;){if(o===t)return o;n.push(o)}for(o=t;o=o.parentNode;){if(o===e)return o;i.push(o)}for(n.reverse(),i.reverse();n[++r]===i[r];);return 0==r?null:n[r-1]},clearEmptySibling:function(e,t,n){function i(e,t){for(var n;e&&!domUtils.isBookmarkNode(e)&&(domUtils.isEmptyInlineElement(e)||!new RegExp("[^\t\n\r"+domUtils.fillChar+"]").test(e.nodeValue));)n=e[t],domUtils.remove(e),e=n}t||i(e.nextSibling,"nextSibling"),n||i(e.previousSibling,"previousSibling")},split:function(e,t){var n=e.ownerDocument;if(browser.ie&&t==e.nodeValue.length){var i=n.createTextNode("");return domUtils.insertAfter(e,i)}var o,r=e.splitText(t);return browser.ie8&&(o=n.createTextNode(""),domUtils.insertAfter(r,o),domUtils.remove(o)),r},isWhitespace:function(e){return!new RegExp("[^ \t\n\r"+domUtils.fillChar+"]").test(e.nodeValue)},getXY:function(e){for(var t=0,n=0;e.offsetParent;)n+=e.offsetTop,t+=e.offsetLeft,e=e.offsetParent;return{x:t,y:n}},isEmptyInlineElement:function(e){if(1!=e.nodeType||!dtd.$removeEmpty[e.tagName])return 0;for(e=e.firstChild;e;){if(domUtils.isBookmarkNode(e))return 0;if(1==e.nodeType&&!domUtils.isEmptyInlineElement(e)||3==e.nodeType&&!domUtils.isWhitespace(e))return 0;e=e.nextSibling}return 1},isBlockElm:function(e){return 1==e.nodeType&&(dtd.$block[e.tagName]||styleBlock[domUtils.getComputedStyle(e,"display")])&&!dtd.$nonChild[e.tagName]},getElementsByTagName:function(e,t,n){var o;n&&utils.isString(n)&&(o=n,n=function(n){var i=!1;return $.each(utils.trim(o).replace(/[ ]{2,}/g," ").split(" "),function(e,t){if($(n).hasClass(t))return!(i=!0)}),i}),t=utils.trim(t).replace(/[ ]{2,}/g," ").split(" ");for(var i,r=[],a=0;i=t[a++];)for(var s,l=e.getElementsByTagName(i),d=0;s=l[d++];)n&&!n(s)||r.push(s);return r},unSelectable:ie&&browser.ie9below||browser.opera?function(e){e.onselectstart=function(){return!1},e.onclick=e.onkeyup=e.onkeydown=function(){return!1},e.unselectable="on",e.setAttribute("unselectable","on");for(var t,n=0;t=e.all[n++];)switch(t.tagName.toLowerCase()){case"iframe":case"textarea":case"input":case"select":break;default:t.unselectable="on",e.setAttribute("unselectable","on")}}:function(e){e.style.MozUserSelect=e.style.webkitUserSelect=e.style.msUserSelect=e.style.KhtmlUserSelect="none"},removeAttributes:function(e,t){t=utils.isArray(t)?t:utils.trim(t).replace(/[ ]{2,}/g," ").split(" ");for(var n,i=0;n=t[i++];){switch(n=attrFix[n]||n){case"className":e[n]="";break;case"style":e.style.cssText="",browser.ie||e.removeAttributeNode(e.getAttributeNode("style"))}e.removeAttribute(n)}},createElement:function(e,t,n){return domUtils.setAttributes(e.createElement(t),n)},setAttributes:function(e,t){for(var n in t)if(t.hasOwnProperty(n)){var i=t[n];switch(n){case"class":e.className=i;break;case"style":e.style.cssText=e.style.cssText+";"+i;break;case"innerHTML":e[n]=i;break;case"value":e.value=i;break;default:e.setAttribute(attrFix[n]||n,i)}}return e},getComputedStyle:function(e,t){return utils.transUnitToPx(utils.fixColor(t,$(e).css(t)))},preventDefault:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},removeStyle:function(e,t){browser.ie?("color"==t&&(t="(^|;)"+t),e.style.cssText=e.style.cssText.replace(new RegExp(t+"[^:]*:[^;]+;?","ig"),"")):e.style.removeProperty?e.style.removeProperty(t):e.style.removeAttribute(utils.cssStyleToDomStyle(t)),e.style.cssText||domUtils.removeAttributes(e,["style"])},getStyle:function(e,t){var n=e.style[utils.cssStyleToDomStyle(t)];return utils.fixColor(t,n)},setStyle:function(e,t,n){e.style[utils.cssStyleToDomStyle(t)]=n,utils.trim(e.style.cssText)||this.removeAttributes(e,"style")},removeDirtyAttr:function(e){for(var t,n=0,i=e.getElementsByTagName("*");t=i[n++];)t.removeAttribute("_moz_dirty");e.removeAttribute("_moz_dirty")},getChildCount:function(e,t){var n=0,i=e.firstChild;for(t=t||function(){return 1};i;)t(i)&&n++,i=i.nextSibling;return n},isEmptyNode:function(e){return!e.firstChild||0==domUtils.getChildCount(e,function(e){return!domUtils.isBr(e)&&!domUtils.isBookmarkNode(e)&&!domUtils.isWhitespace(e)})},isBr:function(e){return 1==e.nodeType&&"BR"==e.tagName},isFillChar:function(e,t){return 3==e.nodeType&&!e.nodeValue.replace(new RegExp((t?"^":"")+domUtils.fillChar),"").length},isEmptyBlock:function(e,t){if(1!=e.nodeType)return 0;if(t=t||new RegExp("[ \t\r\n"+domUtils.fillChar+"]","g"),0<e[browser.ie?"innerText":"textContent"].replace(t,"").length)return 0;for(var n in dtd.$isNotEmpty)if(e.getElementsByTagName(n).length)return 0;return 1},isCustomeNode:function(e){return 1==e.nodeType&&e.getAttribute("_ue_custom_node_")},fillNode:function(e,t){var n=browser.ie?e.createTextNode(domUtils.fillChar):e.createElement("br");t.innerHTML="",t.appendChild(n)},isBoundaryNode:function(e,t){for(;!domUtils.isBody(e);)if(e!==(e=e.parentNode)[t])return!1;return!0},isBody:function(e){return $(e).hasClass("edui-body-container")}},fillCharReg=new RegExp(domUtils.fillChar,"g"),Ne,Le,Me,Re,Vi,Ui,Zi;function Qe(e,t,n,i){var o;return 1==t.nodeType&&(dtd.$empty[t.tagName]||dtd.$nonChild[t.tagName])&&(n=domUtils.getNodeIndex(t)+(e?0:1),t=t.parentNode),e?(i.startContainer=t,i.startOffset=n,i.endContainer||i.collapse(!0)):(i.endContainer=t,i.endOffset=n,i.startContainer||i.collapse(!1)),(o=i).collapsed=o.startContainer&&o.endContainer&&o.startContainer===o.endContainer&&o.startOffset==o.endOffset,i}function Se(e,t){try{if(Ne&&domUtils.inDoc(Ne,e))if(Ne.nodeValue.replace(fillCharReg,"").length)Ne.nodeValue=Ne.nodeValue.replace(fillCharReg,"");else{var n=Ne.parentNode;for(domUtils.remove(Ne);n&&domUtils.isEmptyInlineElement(n)&&(browser.safari?!(domUtils.getPosition(n,t)&domUtils.POSITION_CONTAINS):!n.contains(t));)Ne=n.parentNode,domUtils.remove(n),n=Ne}}catch(e){}}function Te(e,t){var n;for(e=e[t];e&&domUtils.isFillChar(e);)n=e[t],domUtils.remove(e),e=n}function Mh(e,t){var n=domUtils.getNodeIndex;(e=e.duplicate()).collapse(t);var i=e.parentElement();if(!i.hasChildNodes())return{container:i,offset:0};for(var o,r=i.children,a=e.duplicate(),s=0,l=r.length-1,d=-1;s<=l;){h=r[d=Math.floor((s+l)/2)],a.moveToElementText(h);var c=a.compareEndPoints("StartToStart",e);if(0<c)l=d-1;else{if(!(c<0))return{container:i,offset:n(h)};s=d+1}}if(-1==d){if(a.moveToElementText(i),a.setEndPoint("StartToStart",e),o=a.text.replace(/(\r\n|\r)/g,"\n").length,r=i.childNodes,!o)return{container:h=r[r.length-1],offset:h.nodeValue.length};for(var u=r.length;0<o;)o-=r[--u].nodeValue.length;return{container:r[u],offset:-o}}if(a.collapse(0<c),a.setEndPoint(0<c?"StartToStart":"EndToStart",e),!(o=a.text.replace(/(\r\n|\r)/g,"\n").length))return dtd.$empty[h.tagName]||dtd.$nonChild[h.tagName]?{container:i,offset:n(h)+(0<c?0:1)}:{container:h,offset:0<c?0:h.childNodes.length};for(;0<o;)try{var h,f=h;o-=(h=h[0<c?"previousSibling":"nextSibling"]).nodeValue.length}catch(e){return{container:i,offset:n(f)}}return{container:h,offset:0<c?-o:h.nodeValue.length+o}}function Oh(e,t){var n;try{n=e.getNative(t).createRange()}catch(e){return null}var i=n.item?n.item(0):n.parentElement();return(i.ownerDocument||i)===e.document?n:null}function Wi(e,t){var n;if(t.textarea)if(utils.isString(t.textarea)){for(var i,o=0,r=domUtils.getElementsByTagName(e,"textarea");i=r[o++];)if(i.id=="umeditor_textarea_"+t.options.textarea){n=i;break}}else n=t.textarea;n||(e.appendChild(n=domUtils.createElement(document,"textarea",{name:t.options.textarea,id:"umeditor_textarea_"+t.options.textarea,style:"display:none"})),t.textarea=n),n.value=t.hasContents()?t.options.allHtmlEnabled?t.getAllHtml():t.getContent(null,null,!0):""}function Xi(e){for(var t in UM.plugins)-1==e.options.excludePlugins.indexOf(t)&&(UM.plugins[t].call(e),e.plugins[t]=1);e.langIsReady=!0,e.fireEvent("langReady")}function Bl(){var e=this;e.document.getElementById("initContent")&&(e.body.innerHTML="<p>"+(ie?"":"<br/>")+"</p>",e.removeListener("firstBeforeExecCommand focus",Bl),setTimeout(function(){e.focus(),e._selectionChange()},0))}Le=0,Me=domUtils.fillChar,Re=dom.Range=function(e,t){var n=this;n.startContainer=n.startOffset=n.endContainer=n.endOffset=null,n.document=e,n.collapsed=!0,n.body=t},Re.prototype={deleteContents:function(){var e;return this.collapsed||function(e,t){var n,i,o=e.startContainer,r=e.endContainer,a=e.startOffset,s=e.endOffset,l=e.document,d=l.createDocumentFragment();if(1==o.nodeType&&(o=o.childNodes[a]||(n=o.appendChild(l.createTextNode("")))),1==r.nodeType&&(r=r.childNodes[s]||(i=r.appendChild(l.createTextNode("")))),o===r&&3==o.nodeType)return d.appendChild(l.createTextNode(o.substringData(a,s-a))),t&&(o.deleteData(a,s-a),e.collapse(!0));for(var c,u,h=d,f=domUtils.findParents(o,!0),m=domUtils.findParents(r,!0),p=0;f[p]==m[p];)p++;for(var g,b=p;g=f[b];b++){for(c=g.nextSibling,g==o?n||(3==e.startContainer.nodeType?(h.appendChild(l.createTextNode(o.nodeValue.slice(a))),t&&o.deleteData(a,o.nodeValue.length-a)):h.appendChild(t?o:o.cloneNode(!0))):(u=g.cloneNode(!1),h.appendChild(u));c&&c!==r&&c!==m[b];)g=c.nextSibling,h.appendChild(t?c:c.cloneNode(!0)),c=g;h=u}h=d,f[p]||(h.appendChild(f[p-1].cloneNode(!1)),h=h.firstChild);for(var v,b=p;v=m[b];b++){if(c=v.previousSibling,v==r?i||3!=e.endContainer.nodeType||(h.appendChild(l.createTextNode(r.substringData(0,s))),t&&r.deleteData(0,s)):(u=v.cloneNode(!1),h.appendChild(u)),b!=p||!f[p])for(;c&&c!==o;)v=c.previousSibling,h.insertBefore(t?c:c.cloneNode(!0),h.firstChild),c=v;h=u}t&&e.setStartBefore(m[p]?f[p]?m[p]:f[p-1]:m[p-1]).collapse(!0),n&&domUtils.remove(n),i&&domUtils.remove(i)}(this,1),browser.webkit&&(3!=(e=this.startContainer).nodeType||e.nodeValue.length||(this.setStartBefore(e).collapse(!0),domUtils.remove(e))),this},inFillChar:function(){var e=this.startContainer;return!(!this.collapsed||3!=e.nodeType||e.nodeValue.replace(new RegExp("^"+domUtils.fillChar),"").length+1!=e.nodeValue.length)},setStart:function(e,t){return Qe(!0,e,t,this)},setEnd:function(e,t){return Qe(!1,e,t,this)},setStartAfter:function(e){return this.setStart(e.parentNode,domUtils.getNodeIndex(e)+1)},setStartBefore:function(e){return this.setStart(e.parentNode,domUtils.getNodeIndex(e))},setEndAfter:function(e){return this.setEnd(e.parentNode,domUtils.getNodeIndex(e)+1)},setEndBefore:function(e){return this.setEnd(e.parentNode,domUtils.getNodeIndex(e))},setStartAtFirst:function(e){return this.setStart(e,0)},setStartAtLast:function(e){return this.setStart(e,3==e.nodeType?e.nodeValue.length:e.childNodes.length)},setEndAtFirst:function(e){return this.setEnd(e,0)},setEndAtLast:function(e){return this.setEnd(e,3==e.nodeType?e.nodeValue.length:e.childNodes.length)},selectNode:function(e){return this.setStartBefore(e).setEndAfter(e)},selectNodeContents:function(e){return this.setStart(e,0).setEndAtLast(e)},cloneRange:function(){var e=this;return new Re(e.document).setStart(e.startContainer,e.startOffset).setEnd(e.endContainer,e.endOffset)},collapse:function(e){var t=this;return e?(t.endContainer=t.startContainer,t.endOffset=t.startOffset):(t.startContainer=t.endContainer,t.startOffset=t.endOffset),t.collapsed=!0,t},shrinkBoundary:function(e){var t,n=this,i=n.collapsed;function o(e){return 1==e.nodeType&&!domUtils.isBookmarkNode(e)&&!dtd.$empty[e.tagName]&&!dtd.$nonChild[e.tagName]}for(;1==n.startContainer.nodeType&&(t=n.startContainer.childNodes[n.startOffset])&&o(t);)n.setStart(t,0);if(i)return n.collapse(!0);if(!e)for(;1==n.endContainer.nodeType&&0<n.endOffset&&(t=n.endContainer.childNodes[n.endOffset-1])&&o(t);)n.setEnd(t,t.childNodes.length);return n},trimBoundary:function(e){this.txtToElmBoundary();var t,n=this.startContainer,i=this.startOffset,o=this.collapsed,r=this.endContainer;if(3==n.nodeType&&(0==i?this.setStartBefore(n):i>=n.nodeValue.length?this.setStartAfter(n):(t=domUtils.split(n,i),n===r?this.setEnd(t,this.endOffset-i):n.parentNode===r&&(this.endOffset+=1),this.setStartBefore(t)),o))return this.collapse(!0);return e||(i=this.endOffset,3==(r=this.endContainer).nodeType&&(0==i?this.setEndBefore(r):(i<r.nodeValue.length&&domUtils.split(r,i),this.setEndAfter(r)))),this},txtToElmBoundary:function(e){function t(e,t){var n=e[t+"Container"],i=e[t+"Offset"];3==n.nodeType&&(i?i>=n.nodeValue.length&&e["set"+t.replace(/(\w)/,function(e){return e.toUpperCase()})+"After"](n):e["set"+t.replace(/(\w)/,function(e){return e.toUpperCase()})+"Before"](n))}return!e&&this.collapsed||(t(this,"start"),t(this,"end")),this},insertNode:function(e){var t=e,n=1;11==e.nodeType&&(t=e.firstChild,n=e.childNodes.length),this.trimBoundary(!0);var i=this.startContainer,o=this.startOffset,r=i.childNodes[o];return r?i.insertBefore(e,r):i.appendChild(e),t.parentNode===this.endContainer&&(this.endOffset=this.endOffset+n),this.setStartBefore(t)},setCursor:function(e,t){return this.collapse(!e).select(t)},createBookmark:function(e,t){var n,i=this.document.createElement("span");return i.style.cssText="display:none;line-height:0px;",i.appendChild(this.document.createTextNode("‍")),i.id="_baidu_bookmark_start_"+(t?"":Le++),this.collapsed||((n=i.cloneNode(!0)).id="_baidu_bookmark_end_"+(t?"":Le++)),this.insertNode(i),n&&this.collapse().insertNode(n).setEndBefore(n),this.setStartAfter(i),{start:e?i.id:i,end:n?e?n.id:n:null,id:e}},moveToBookmark:function(e){var t=e.id?this.document.getElementById(e.start):e.start,n=e.end&&e.id?this.document.getElementById(e.end):e.end;return this.setStartBefore(t),domUtils.remove(t),n?(this.setEndBefore(n),domUtils.remove(n)):this.collapse(!0),this},adjustmentBoundary:function(){if(!this.collapsed){for(;!domUtils.isBody(this.startContainer)&&this.startOffset==this.startContainer[3==this.startContainer.nodeType?"nodeValue":"childNodes"].length&&this.startContainer[3==this.startContainer.nodeType?"nodeValue":"childNodes"].length;)this.setStartAfter(this.startContainer);for(;!domUtils.isBody(this.endContainer)&&!this.endOffset&&this.endContainer[3==this.endContainer.nodeType?"nodeValue":"childNodes"].length;)this.setEndBefore(this.endContainer)}return this},getClosedNode:function(){var e,t,n,i;return this.collapsed||(t=this.cloneRange().adjustmentBoundary().shrinkBoundary(),(i=t).collapsed||1!=i.startContainer.nodeType||i.startContainer!==i.endContainer||i.endOffset-i.startOffset!=1||(n=t.startContainer.childNodes[t.startOffset])&&1==n.nodeType&&(dtd.$empty[n.tagName]||dtd.$nonChild[n.tagName])&&(e=n)),e},select:browser.ie?function(e,t){this.collapsed||this.shrinkBoundary();var n=this.getClosedNode();if(n&&!t){try{(s=this.document.body.createControlRange()).addElement(n),s.select()}catch(e){}return this}var i,o,r,a,s,l=this.createBookmark(),d=l.start;(s=this.document.body.createTextRange()).moveToElementText(d),s.moveStart("character",1),this.collapsed?e||3==this.startContainer.nodeType||(i=this.document.createTextNode(Me),(o=this.document.createElement("span")).appendChild(this.document.createTextNode(Me)),d.parentNode.insertBefore(o,d),d.parentNode.insertBefore(i,d),Se(this.document,i),Ne=i,Te(o,"previousSibling"),Te(d,"nextSibling"),s.moveStart("character",-1),s.collapse(!0)):(r=this.document.body.createTextRange(),a=l.end,r.moveToElementText(a),s.setEndPoint("EndToEnd",r)),this.moveToBookmark(l),o&&domUtils.remove(o);try{s.select()}catch(e){}return this}:function(e){var t,n,i,o=domUtils.getWindow(this.document),r=o.getSelection();if(browser.gecko?this.body.focus():o.focus(),r){r.removeAllRanges(),this.collapsed&&!e&&(1==(a=n=this.startContainer).nodeType&&(a=n.childNodes[this.startOffset]),3==n.nodeType&&this.startOffset||(a?a.previousSibling&&3==a.previousSibling.nodeType:n.lastChild&&3==n.lastChild.nodeType)||(t=this.document.createTextNode(Me),this.insertNode(t),Se(this.document,t),Te(t,"previousSibling"),Te(t,"nextSibling"),Ne=t,this.setStart(t,browser.webkit?1:0).collapse(!0)));var a,s=this.document.createRange();if(this.collapsed&&browser.opera&&1==this.startContainer.nodeType)if(a=this.startContainer.childNodes[this.startOffset]){for(;a&&domUtils.isBlockElm(a)&&1==a.nodeType&&a.childNodes[0];)a=a.childNodes[0];a&&this.setStartBefore(a).collapse(!0)}else(a=this.startContainer.lastChild)&&domUtils.isBr(a)&&this.setStartBefore(a).collapse(!0);l((i=this).startContainer,i.startOffset,"start"),l(i.endContainer,i.endOffset,"end"),s.setStart(this.startContainer,this.startOffset),s.setEnd(this.endContainer,this.endOffset),r.addRange(s)}function l(e,t,n){3==e.nodeType&&e.nodeValue.length<t&&(i[n+"Offset"]=e.nodeValue.length)}return this},createAddress:function(e,d){var t={},c=this;function n(e){for(var t,n=e?c.startContainer:c.endContainer,i=domUtils.findParents(n,!0,function(e){return!domUtils.isBody(e)}),o=[],r=0;t=i[r++];)o.push(domUtils.getNodeIndex(t,d));var a=0;if(d)if(3==n.nodeType){for(var s=n.previousSibling;s&&3==s.nodeType;)a+=s.nodeValue.replace(fillCharReg,"").length,s=s.previousSibling;a+=e?c.startOffset:c.endOffset}else if(n=n.childNodes[e?c.startOffset:c.endOffset])a=domUtils.getNodeIndex(n,d);else for(var l=(n=e?c.startContainer:c.endContainer).firstChild;l;)if(domUtils.isFillChar(l))l=l.nextSibling;else if(a++,3==l.nodeType)for(;l&&3==l.nodeType;)l=l.nextSibling;else l=l.nextSibling;else a=e?domUtils.isFillChar(n)?0:c.startOffset:c.endOffset;return a<0&&(a=0),o.push(a),o}return t.startAddress=n(!0),e||(t.endAddress=c.collapsed?[].concat(t.startAddress):n()),t},moveToAddress:function(e,t){var l=this;function n(e,t){for(var n,i,o,r=l.body,a=0,s=e.length;a<s;a++)if(o=e[a],!(r=(n=r).childNodes[o])){i=o;break}t?r?l.setStartBefore(r):l.setStart(n,i):r?l.setEndBefore(r):l.setEnd(n,i)}return n(e.startAddress,!0),!t&&e.endAddress&&n(e.endAddress),l},equals:function(e){for(var t in this)if(this.hasOwnProperty(t)&&this[t]!==e[t])return!1;return!0},scrollIntoView:function(){var e=$('<span style="padding:0;margin:0;display:block;border:0">&nbsp;</span>');this.cloneRange().insertNode(e.get(0));var t=$(window).scrollTop(),n=$(window).height(),i=e.offset().top;(i<t-n||t+n<i)&&(t+n<i?window.scrollTo(0,i-n+e.height()):window.scrollTo(0,t-i)),e.remove()},getOffset:function(){var e=this.createBookmark(),t=$(e.start).css("display","inline-block").offset();return this.moveToBookmark(e),t}},(dom.Selection=function(e,t){var n=this;n.document=e,n.body=t,browser.ie9below&&$(t).on("beforedeactivate",function(){n._bakIERange=n.getIERange()}).on("activate",function(){try{var e=Oh(n);e&&n.rangeInBody(e)||!n._bakIERange||n._bakIERange.select()}catch(e){}n._bakIERange=null})}).prototype={hasNativeRange:function(){var e;if(!browser.ie||browser.ie9above){var t=this.getNative();if(!t.rangeCount)return!1;e=t.getRangeAt(0)}else e=Oh(this);return this.rangeInBody(e)},getNative:function(e){var t=this.document;try{return t?browser.ie9below||e?t.selection:domUtils.getWindow(t).getSelection():null}catch(e){return null}},getIERange:function(e){var t=Oh(this,e);return t&&this.rangeInBody(t,e)||!this._bakIERange?t:this._bakIERange},rangeInBody:function(e,t){var n=browser.ie9below||t?e.item?e.item():e.parentElement():e.startContainer;return n===this.body||domUtils.inDoc(n,this.body)},cache:function(){this.clear(),this._cachedRange=this.getRange(),this._cachedStartElement=this.getStart(),this._cachedStartElementPath=this.getStartElementPath()},getStartElementPath:function(){if(this._cachedStartElementPath)return this._cachedStartElementPath;var e=this.getStart();return e?domUtils.findParents(e,!0,null,!0):[]},clear:function(){this._cachedStartElementPath=this._cachedRange=this._cachedStartElement=null},isFocus:function(){return this.hasNativeRange()},getRange:function(){var i=this;function t(e){for(var t=i.body.firstChild,n=e.collapsed;t&&t.firstChild;)e.setStart(t,0),t=t.firstChild;e.startContainer||e.setStart(i.body,0),n&&e.collapse(!0)}if(null!=i._cachedRange)return this._cachedRange;var e,n,o,r=new dom.Range(i.document,i.body);if(browser.ie9below){var a=i.getIERange();if(a&&this.rangeInBody(a))try{n=r,(e=a).item?n.selectNode(e.item(0)):(o=Mh(e,!0),n.setStart(o.container,o.offset),0!=e.compareEndPoints("StartToEnd",e)&&(o=Mh(e,!1),n.setEnd(o.container,o.offset)))}catch(e){t(r)}else t(r)}else{var s=i.getNative();if(s&&s.rangeCount&&i.rangeInBody(s.getRangeAt(0))){var l=s.getRangeAt(0),d=s.getRangeAt(s.rangeCount-1);r.setStart(l.startContainer,l.startOffset).setEnd(d.endContainer,d.endOffset),r.collapsed&&domUtils.isBody(r.startContainer)&&!r.startOffset&&t(r)}else{if(this._bakRange&&(this._bakRange.startContainer===this.body||domUtils.inDoc(this._bakRange.startContainer,this.body)))return this._bakRange;t(r)}}return this._bakRange=r},getStart:function(){if(this._cachedStartElement)return this._cachedStartElement;var e,t,n,i,o=browser.ie9below?this.getIERange():this.getRange();if(browser.ie9below){if(!o)return this.document.body.firstChild;if(o.item)return o.item(0);for(0<(e=o.duplicate()).text.length&&e.moveStart("character",1),e.collapse(1),t=e.parentElement(),i=n=o.parentElement();n=n.parentNode;)if(n==t){t=i;break}}else if(1==(t=o.startContainer).nodeType&&t.hasChildNodes()&&(t=t.childNodes[Math.min(t.childNodes.length-1,o.startOffset)]),3==t.nodeType)return t.parentNode;return t},getText:function(){var e,t;return this.isFocus()&&(e=this.getNative())?(t=browser.ie9below?e.createRange():e.getRangeAt(0),browser.ie9below?t.text:t.toString()):""}},Ui=0,Zi=UM.Editor=function(e){var t=this;t.uid=Ui++,EventBase.call(t),t.commands={},t.options=utils.extend(utils.clone(e||{}),UMEDITOR_CONFIG,!0),t.shortcutkeys={},t.inputRules=[],t.outputRules=[],t.setOpt({isShow:!0,initialContent:"",initialStyle:"",autoClearinitialContent:!1,textarea:"editorValue",focus:!1,focusInEnd:!0,autoClearEmptyNode:!0,fullscreen:!1,readonly:!1,zIndex:999,enterTag:"p",lang:"zh-cn",langPath:t.options.UMEDITOR_HOME_URL+"lang/",theme:"default",themePath:t.options.UMEDITOR_HOME_URL+"themes/",allHtmlEnabled:!1,autoSyncData:!0,autoHeightEnabled:!0,excludePlugins:""}),t.plugins={},utils.isEmptyObject(UM.I18N)?utils.loadFile(document,{src:t.options.langPath+t.options.lang+"/"+t.options.lang+".js",tag:"script",type:"text/javascript",defer:"defer"},function(){Xi(t)}):(t.options.lang=function(e){for(var t in e)return t}(UM.I18N),Xi(t))},Zi.prototype={ready:function(e){e&&(this.isReady?e.apply(this):this.addListener("ready",e))},setOpt:function(e,t){var n={};utils.isString(e)?n[e]=t:n=e,utils.extend(this.options,n,!0)},getOpt:function(e){return this.options[e]||""},destroy:function(){var e=this;e.fireEvent("destroy");var t=e.container.parentNode;t===document.body&&(t=e.container);var n,i=e.textarea;for(n in i?i.style.display="":(i=document.createElement("textarea"),t.parentNode.insertBefore(i,t)),i.style.width=e.body.offsetWidth+"px",i.style.height=e.body.offsetHeight+"px",i.value=e.getContent(),i.id=e.key,t.contains(i)&&$(i).insertBefore(t),t.innerHTML="",domUtils.remove(t),UM.clearCache(e.id),e)e.hasOwnProperty(n)&&delete this[n]},initialCont:function(e){var t;return e?(e.getAttribute("name")&&(this.options.textarea=e.getAttribute("name")),e&&/script|textarea/gi.test(e.tagName)&&(t=document.createElement("div"),e.parentNode.insertBefore(t,e),this.options.initialContent=UM.htmlparser(e.value||e.innerHTML||this.options.initialContent).toHtml(),e.className&&(t.className=e.className),e.style.cssText&&(t.style.cssText=e.style.cssText),/textarea/i.test(e.tagName)?(this.textarea=e,this.textarea.style.display="none"):(e.parentNode.removeChild(e),e.id&&(t.id=e.id)),(e=t).innerHTML=""),e):null},render:function(t){function e(e){return parseInt($(t).css(e))}var n,i=this.options;utils.isString(t)&&(t=document.getElementById(t)),t&&(this.id=t.getAttribute("id"),UM.setEditor(this),utils.cssRule("edui-style-body",this.options.initialStyle,document),(t=this.initialCont(t)).className+=" edui-body-container",i.initialFrameWidth?i.minFrameWidth=i.initialFrameWidth:i.minFrameWidth=i.initialFrameWidth=$(t).width()||UM.defaultWidth,i.initialFrameHeight?i.minFrameHeight=i.initialFrameHeight:i.initialFrameHeight=i.minFrameHeight=$(t).height()||UM.defaultHeight,t.style.width=/%$/.test(i.initialFrameWidth)?"100%":i.initialFrameWidth-e("padding-left")-e("padding-right")+"px",n=/%$/.test(i.initialFrameHeight)?"100%":i.initialFrameHeight-e("padding-top")-e("padding-bottom"),this.options.autoHeightEnabled?(t.style.minHeight=n+"px",t.style.height="",browser.ie&&browser.version<=6&&(t.style.height=n,t.style.setExpression("height","this.scrollHeight <= "+n+' ? "'+n+'px" : "auto"'))):$(t).height(n),t.style.zIndex=i.zIndex,this._setup(t))},_setup:function(e){var t,n=this,i=n.options;e.contentEditable=!0,document.body.spellcheck=!1,n.document=document,n.window=document.defaultView||document.parentWindow,n.body=e,n.$body=$(e),n.selection=new dom.Selection(document,n.body),n._isEnabled=!1,browser.gecko&&(t=this.selection.getNative())&&t.removeAllRanges(),this._initEvents();for(var o,r=e.parentNode;r&&!domUtils.isBody(r);r=r.parentNode)if("FORM"==r.tagName){n.form=r,n.options.autoSyncData?$(e).on("blur",function(){Wi(r,n)}):$(r).on("submit",function(){Wi(this,n)});break}i.initialContent&&(i.autoClearinitialContent?(o=n.execCommand,n.execCommand=function(){return n.fireEvent("firstBeforeExecCommand"),o.apply(n,arguments)},this._setDefaultContent(i.initialContent)):this.setContent(i.initialContent,!1,!0)),domUtils.isEmptyNode(n.body)&&(n.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>"),i.focus&&setTimeout(function(){n.focus(n.options.focusInEnd),n.options.autoClearinitialContent||n._selectionChange()},0),n.container||(n.container=e.parentNode),n._bindshortcutKeys(),n.isReady=1,n.fireEvent("ready"),i.onready&&i.onready.call(n),browser.ie&&!browser.ie9above||$(n.body).on("blur focus",function(e){var t=n.selection.getNative();if("blur"==e.type)0<t.rangeCount&&(n._bakRange=t.getRangeAt(0));else{try{n._bakRange&&t.addRange(n._bakRange)}catch(e){}n._bakRange=null}}),i.isShow||n.setHide(),i.readonly&&n.setDisabled()},sync:function(e){var t=e?document.getElementById(e):domUtils.findParent(this.body.parentNode,function(e){return"FORM"==e.tagName},!0);t&&Wi(t,this)},setHeight:function(e,t){t||(this.options.initialFrameHeight=e),this.options.autoHeightEnabled?($(this.body).css({"min-height":e+"px"}),browser.ie&&browser.version<=6&&this.container&&(this.container.style.height=e,this.container.style.setExpression("height","this.scrollHeight <= "+e+' ? "'+e+'px" : "auto"'))):$(this.body).height(e),this.fireEvent("resize")},setWidth:function(e){this.$container&&this.$container.width(e),$(this.body).width(e-$(this.body).css("padding-left").replace("px","")-$(this.body).css("padding-right").replace("px","")),this.fireEvent("resize")},addshortcutkey:function(e,t){var n={};t?n[e]=t:n=e,utils.extend(this.shortcutkeys,n)},_bindshortcutKeys:function(){var d=this,c=this.shortcutkeys;d.addListener("keydown",function(e,t){var n,i=t.keyCode||t.which;for(n in c)for(var o,r=c[n].split(","),a=0;o=r[a++];){var s=(o=o.split(":"))[0],l=o[1];(/^(ctrl)(\+shift)?\+(\d+)$/.test(s.toLowerCase())||/^(\d+)$/.test(s))&&(("ctrl"!=RegExp.$1||!t.ctrlKey&&!t.metaKey||""!=RegExp.$2&&!t[RegExp.$2.slice(1)+"Key"]||i!=RegExp.$3)&&i!=RegExp.$1||(-1!=d.queryCommandState(n,l)&&d.execCommand(n,l),domUtils.preventDefault(t)))}})},getContent:function(e,t,n,i,o){if(e&&utils.isFunction(e)&&(t=e,e=""),t?!t():!this.hasContents())return"";this.fireEvent("beforegetcontent");var r=UM.htmlparser(this.body.innerHTML,i);return this.filterOutputRule(r),this.fireEvent("aftergetcontent",r),r.toHtml(o)},getAllHtml:function(){var t,e=this,n=[];return e.fireEvent("getAllHtml",n),browser.ie&&8<browser.version&&(t="",utils.each(e.document.styleSheets,function(e){t+=e.href?'<link rel="stylesheet" type="text/css" href="'+e.href+'" />':"<style>"+e.cssText+"</style>"}),utils.each(e.document.getElementsByTagName("script"),function(e){t+=e.outerHTML})),"<html><head>"+(e.options.charset?'<meta http-equiv="Content-Type" content="text/html; charset='+e.options.charset+'"/>':"")+(t||e.document.getElementsByTagName("head")[0].innerHTML)+n.join("\n")+"</head><body "+(ie&&browser.version<9?'class="view"':"")+">"+e.getContent(null,null,!0)+"</body></html>"},getPlainTxt:function(){var e=new RegExp(domUtils.fillChar,"g");return this.body.innerHTML.replace(/[\n\r]/g,"").replace(/<(p|div)[^>]*>(<br\/?>|&nbsp;)<\/\1>/gi,"\n").replace(/<br\/?>/gi,"\n").replace(/<[^>/]+>/g,"").replace(/(\n)?<\/([^>]+)>/g,function(e,t,n){return dtd.$block[n]?"\n":t||""}).replace(e,"").replace(/\u00a0/g," ").replace(/&nbsp;/g," ")},getContentTxt:function(){var e=new RegExp(domUtils.fillChar,"g");return this.body[browser.ie?"innerText":"textContent"].replace(e,"").replace(/\u00a0/g," ")},setContent:function(e,t,n){var i=this;i.fireEvent("beforesetcontent",e);var o,r,a=UM.htmlparser(e);if(i.filterInputRule(a),e=a.toHtml(),i.body.innerHTML=(t?i.body.innerHTML:"")+e,"p"==i.options.enterTag){var s,l=this.body.firstChild;if(!l||1==l.nodeType&&(dtd.$cdata[l.tagName]||"DIV"==(o=l).tagName&&o.getAttribute("cdata_tag")||domUtils.isCustomeNode(l))&&l===this.body.lastChild)this.body.innerHTML="<p>"+(browser.ie?"&nbsp;":"<br/>")+"</p>"+this.body.innerHTML;else for(var d=i.document.createElement("p");l;){for(;l&&(3==l.nodeType||1==l.nodeType&&dtd.p[l.tagName]&&!dtd.$cdata[l.tagName]);)s=l.nextSibling,d.appendChild(l),l=s;if(d.firstChild){if(!l){i.body.appendChild(d);break}l.parentNode.insertBefore(d,l),d=i.document.createElement("p")}l=l.nextSibling}}i.fireEvent("aftersetcontent"),i.fireEvent("contentchange"),n||i._selectionChange(),i._bakRange=i._bakIERange=i._bakNativeRange=null,browser.gecko&&(r=this.selection.getNative())&&r.removeAllRanges(),i.options.autoSyncData&&i.form&&Wi(i.form,i)},focus:function(e){try{var t=this.selection.getRange();e?t.setStartAtLast(this.body.lastChild).setCursor(!1,!0):t.select(!0),this.fireEvent("focus")}catch(e){}},blur:function(){var e=this.selection.getNative();e.empty?e.empty():e.removeAllRanges(),this.fireEvent("blur")},isFocus:function(){return!0===this.fireEvent("isfocus")||this.selection.isFocus()},_initEvents:function(){function e(){t._proxyDomEvent.apply(t,arguments)}var t=this,n=t.body;$(n).on("click contextmenu mousedown keydown keyup keypress mouseup mouseover mouseout selectstart",e).on("focus blur",e).on("mouseup keydown",function(e){"keydown"==e.type&&(e.ctrlKey||e.metaKey||e.shiftKey||e.altKey)||2!=e.button&&t._selectionChange(250,e)})},_proxyDomEvent:function(e){return this.fireEvent(e.type.replace(/^on/,""),e)},_selectionChange:function(e,n){var i,o,r=this,a=!1;browser.ie&&browser.version<9&&n&&"mouseup"==n.type&&(this.selection.getRange().collapsed||(a=!0,i=n.clientX,o=n.clientY)),clearTimeout(Vi),Vi=setTimeout(function(){if(r.selection.getNative()){var t,e;if(a&&"None"==r.selection.getNative().type){t=r.document.body.createTextRange();try{t.moveToPoint(i,o)}catch(e){t=null}}t&&(e=r.selection.getIERange,r.selection.getIERange=function(){return t}),r.selection.cache(),e&&(r.selection.getIERange=e),r.selection._cachedRange&&r.selection._cachedStartElement&&(r.fireEvent("beforeselectionchange"),r.fireEvent("selectionchange",!!n),r.fireEvent("afterselectionchange"),r.selection.clear())}},e||50)},_callCmdFn:function(e,t){var n=(t=Array.prototype.slice.call(t,0)).shift().toLowerCase(),i=this.commands[n]||UM.commands[n],o=i&&i[e];return i&&o||"queryCommandState"!=e?o?o.apply(this,[n].concat(t)):void 0:0},execCommand:function(e){var t;this.isFocus()||((t=this.selection._bakRange)?t.select():this.focus(!0)),e=e.toLowerCase();var n,i=this,o=i.commands[e]||UM.commands[e];return o&&o.execCommand?(o.notNeedUndo||i.__hasEnterExecCommand?(n=this._callCmdFn("execCommand",arguments),i.__hasEnterExecCommand||o.ignoreContentChange||i._ignoreContentChange||i.fireEvent("contentchange")):(i.__hasEnterExecCommand=!0,-1!=i.queryCommandState.apply(i,arguments)&&(i.fireEvent("saveScene"),i.fireEvent("beforeexeccommand",e),n=this._callCmdFn("execCommand",arguments),o.ignoreContentChange||i._ignoreContentChange||i.fireEvent("contentchange"),i.fireEvent("afterexeccommand",e),i.fireEvent("saveScene")),i.__hasEnterExecCommand=!1),i.__hasEnterExecCommand||o.ignoreContentChange||i._ignoreContentChange||i._selectionChange(),n):null},queryCommandState:function(e){try{return this._callCmdFn("queryCommandState",arguments)}catch(e){return 0}},queryCommandValue:function(e){try{return this._callCmdFn("queryCommandValue",arguments)}catch(e){return null}},hasContents:function(e){if(e)for(var t,n=0;t=e[n++];)if(0<this.body.getElementsByTagName(t).length)return!0;if(!domUtils.isEmptyBlock(this.body))return!0;for(e=["div"],n=0;t=e[n++];)for(var i,o=domUtils.getElementsByTagName(this.body,t),r=0;i=o[r++];)if(domUtils.isCustomeNode(i))return!0;return!1},reset:function(){this.fireEvent("reset")},isEnabled:function(){return 1!=this._isEnabled},setEnabled:function(){var t,n=this;if(n.body.contentEditable=!0,n.lastBk){t=n.selection.getRange();try{t.moveToBookmark(n.lastBk),delete n.lastBk}catch(e){t.setStartAtFirst(n.body).collapse(!0)}t.select(!0)}n.bkqueryCommandState&&(n.queryCommandState=n.bkqueryCommandState,delete n.bkqueryCommandState),n._bkproxyDomEvent&&(n._proxyDomEvent=n._bkproxyDomEvent,delete n._bkproxyDomEvent),n.fireEvent("setEnabled")},enable:function(){return this.setEnabled()},setDisabled:function(e,t){var n=this;n.body.contentEditable=!1,n._except=e?utils.isArray(e)?e:[e]:[],n.lastBk||(n.lastBk=n.selection.getRange().createBookmark(!0)),n.bkqueryCommandState||(n.bkqueryCommandState=n.queryCommandState,n.queryCommandState=function(e){return-1!=utils.indexOf(n._except,e)?n.bkqueryCommandState.apply(n,arguments):-1}),t||n._bkproxyDomEvent||(n._bkproxyDomEvent=n._proxyDomEvent,n._proxyDomEvent=function(){return!1}),n.fireEvent("selectionchange"),n.fireEvent("setDisabled",n._except)},disable:function(e){return this.setDisabled(e)},_setDefaultContent:function(e){this.body.innerHTML='<p id="initContent">'+e+"</p>",this.addListener("firstBeforeExecCommand focus",Bl)},setShow:function(){var t=this,n=t.selection.getRange();if("none"==t.container.style.display){try{n.moveToBookmark(t.lastBk),delete t.lastBk}catch(e){n.setStartAtFirst(t.body).collapse(!0)}setTimeout(function(){n.select(!0)},100),t.container.style.display=""}},show:function(){return this.setShow()},setHide:function(){this.lastBk||(this.lastBk=this.selection.getRange().createBookmark(!0)),this.container.style.display="none"},hide:function(){return this.setHide()},getLang:function(e){var t=UM.I18N[this.options.lang];if(!t)throw Error("not import language file");e=(e||"").split(".");for(var n,i=0;(n=e[i++])&&(t=t[n]););return t},getContentLength:function(e,t){var n=this.getContent(!1,!1,!0).length;if(e){t=(t||[]).concat(["hr","img","iframe"]),n=this.getContentTxt().replace(/[\t\r\n]+/g,"").length;for(var i,o=0;i=t[o++];)n+=this.body.getElementsByTagName(i).length}return n},addInputRule:function(e,t){e.ignoreUndo=t,this.inputRules.push(e)},filterInputRule:function(e,t){for(var n,i=0;n=this.inputRules[i++];)t&&n.ignoreUndo||n.call(this,e)},addOutputRule:function(e,t){e.ignoreUndo=t,this.outputRules.push(e)},filterOutputRule:function(e,t){for(var n,i=0;n=this.outputRules[i++];)t&&n.ignoreUndo||n.call(this,e)}},utils.inherits(Zi,EventBase);var filterWord=UM.filterWord=function(e){return/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument|<(v|o):|lang=)/gi.test(e)?e.replace(/[\t\r\n]+/g," ").replace(/<!--[\s\S]*?-->/gi,"").replace(/<v:shape [^>]*>[\s\S]*?.<\/v:shape>/gi,function(e){if(browser.opera)return"";try{if(/Bitmap/i.test(e))return"";var t=e.match(/width:([ \d.]*p[tx])/i)[1],n=e.match(/height:([ \d.]*p[tx])/i)[1],i=e.match(/src=\s*"([^"]*)"/i)[1];return'<img width="'+dm(t)+'" height="'+dm(n)+'" src="'+i+'" />'}catch(e){return""}}).replace(/<\/?div[^>]*>/g,"").replace(/v:\w+=(["']?)[^'"]+\1/g,"").replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|xml|meta|link|style|\w+:\w+)(?=[\s\/>]))[^>]*>/gi,"").replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1</strong></p>").replace(/\s+(class|lang|align)\s*=\s*(['"]?)([\w-]+)\2/gi,function(e,t,n,i){return"class"==t&&"MsoListParagraph"==i?e:""}).replace(/<(font|span)[^>]*>(\s*)<\/\1>/gi,function(e,t,n){return n.replace(/[\t\r\n ]+/g," ")}).replace(/(<[a-z][^>]*)\sstyle=(["'])([^\2]*?)\2/gi,function(e,t,n,i){for(var o,r=[],a=i.replace(/^\s+|\s+$/,"").replace(/&#39;/g,"'").replace(/&quot;/gi,"'").split(/;\s*/g),s=0;o=a[s];s++){var l,d,c=o.split(":");if(2==c.length){if(l=c[0].toLowerCase(),d=c[1].toLowerCase(),/^(background)\w*/.test(l)&&0==d.replace(/(initial|\s)/g,"").length||/^(margin)\w*/.test(l)&&/^0\w+$/.test(d))continue;switch(l){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":/<table/.test(t)||(r[s]=l.replace(/^mso-|-alt$/g,"")+":"+dm(d));continue;case"horiz-align":r[s]="text-align:"+d;continue;case"vert-align":r[s]="vertical-align:"+d;continue;case"font-color":case"mso-foreground":r[s]="color:"+d;continue;case"mso-background":case"mso-highlight":r[s]="background:"+d;continue;case"mso-default-height":r[s]="min-height:"+dm(d);continue;case"mso-default-width":r[s]="min-width:"+dm(d);continue;case"mso-padding-between-alt":r[s]="border-collapse:separate;border-spacing:"+dm(d);continue;case"text-line-through":"single"!=d&&"double"!=d||(r[s]="text-decoration:line-through");continue;case"mso-zero-height":"yes"==d&&(r[s]="display:none");continue;case"margin":if(!/[1-9]/.test(d))continue}if(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?:decor|trans)|top-bar|version|vnd|word-break)/.test(l)||/text\-indent|padding|margin/.test(l)&&/\-[\d.]+/.test(d))continue;r[s]=l+":"+c[1]}}return t+(r.length?' style="'+r.join(";").replace(/;{2,}/g,";")+'"':"")}).replace(/[\d.]+(cm|pt)/g,function(e){return utils.transUnitToPx(e)}):e},Im,Jm,Km,Lm,Mm;function dm(e){return e=e.replace(/[\d.]+\w+/g,function(e){return utils.transUnitToPx(e)})}function Nm(e,t,n){return e.push(Mm),t+(n?1:-1)}function Om(e,t){for(var n=0;n<t;n++)e.push(Lm)}function Pm(e,t,n,i){switch(e.type){case"root":for(var o,r=0;o=e.children[r++];)n&&"element"==o.type&&!dtd.$inlineWithA[o.tagName]&&1<r&&(Nm(t,i,!0),Om(t,i)),Pm(o,t,n,i);break;case"text":l=t,"pre"==(s=e).parentNode.tagName?l.push(s.data):l.push(Km[s.parentNode.tagName]?utils.html(s.data):s.data.replace(/[ ]{2}/g," &nbsp;"));break;case"element":!function(e,t,n,i){var o="";if(e.attrs){o=[];var r,a=e.attrs;for(r in a)o.push(r+(void 0!==a[r]?'="'+(Jm[r]?utils.html(a[r]).replace(/["]/g,function(e){return"&quot;"}):utils.unhtml(a[r]))+'"':""));o=o.join(" ")}t.push("<"+e.tagName+(o?" "+o:"")+(dtd.$empty[e.tagName]?"/":"")+">"),!n||dtd.$inlineWithA[e.tagName]||"pre"==e.tagName||e.children&&e.children.length&&(i=Nm(t,i,!0),Om(t,i));if(e.children&&e.children.length)for(var s,l=0;s=e.children[l++];)n&&"element"==s.type&&!dtd.$inlineWithA[s.tagName]&&1<l&&(Nm(t,i),Om(t,i)),Pm(s,t,n,i);dtd.$empty[e.tagName]||(n&&!dtd.$inlineWithA[e.tagName]&&"pre"!=e.tagName&&e.children&&e.children.length&&(i=Nm(t,i),Om(t,i)),t.push("</"+e.tagName+">"))}(e,t,n,i);break;case"comment":a=e,t.push("\x3c!--"+a.data+"--\x3e")}var a,s,l;return t}Im=UM.uNode=function(e){this.type=e.type,this.data=e.data,this.tagName=e.tagName,this.parentNode=e.parentNode,this.attrs=e.attrs||{},this.children=e.children},Jm={href:1,src:1,_src:1,_href:1,cdata_data:1},Km={style:1,script:1},Lm="    ",Mm="\n",Im.createElement=function(e){return/[<>]/.test(e)?UM.htmlparser(e).children[0]:new Im({type:"element",children:[],tagName:e})},Im.createText=function(e,t){return new UM.uNode({type:"text",data:t?e:utils.unhtml(e||"")})},Im.prototype={toHtml:function(e){var t=[];return Pm(this,t,e,0),t.join("")},innerHTML:function(e){if("element"!=this.type||dtd.$empty[this.tagName])return this;if(utils.isString(e)){if(this.children)for(var t=0;n=this.children[t++];)n.parentNode=null;this.children=[];for(var n,i=UM.htmlparser(e),t=0;n=i.children[t++];)this.children.push(n),n.parentNode=this;return this}return(i=new UM.uNode({type:"root",children:this.children})).toHtml()},innerText:function(e,t){if("element"!=this.type||dtd.$empty[this.tagName])return this;if(e){if(this.children)for(var n,i=0;n=this.children[i++];)n.parentNode=null;return this.children=[],this.appendChild(Im.createText(e,t)),this}return this.toHtml().replace(/<[^>]+>/g,"")},getData:function(){return"element"==this.type?"":this.data},firstChild:function(){return this.children?this.children[0]:null},lastChild:function(){return this.children?this.children[this.children.length-1]:null},previousSibling:function(){for(var e,t=this.parentNode,n=0;e=t.children[n];n++)if(e===this)return 0==n?null:t.children[n-1]},nextSibling:function(){for(var e,t=this.parentNode,n=0;e=t.children[n++];)if(e===this)return t.children[n]},replaceChild:function(e,t){if(this.children){e.parentNode&&e.parentNode.removeChild(e);for(var n,i=0;n=this.children[i];i++)if(n===t)return this.children.splice(i,1,e),t.parentNode=null,e.parentNode=this,e}},appendChild:function(e){if("root"==this.type||"element"==this.type&&!dtd.$empty[this.tagName]){this.children||(this.children=[]),e.parentNode&&e.parentNode.removeChild(e);for(var t,n=0;t=this.children[n];n++)if(t===e){this.children.splice(n,1);break}return this.children.push(e),e.parentNode=this,e}},insertBefore:function(e,t){if(this.children){e.parentNode&&e.parentNode.removeChild(e);for(var n,i=0;n=this.children[i];i++)if(n===t)return this.children.splice(i,0,e),e.parentNode=this,e}},insertAfter:function(e,t){if(this.children){e.parentNode&&e.parentNode.removeChild(e);for(var n,i=0;n=this.children[i];i++)if(n===t)return this.children.splice(i+1,0,e),e.parentNode=this,e}},removeChild:function(e,t){if(this.children)for(var n,i=0;n=this.children[i];i++)if(n===e){if(this.children.splice(i,1),n.parentNode=null,t&&n.children&&n.children.length)for(var o,r=0;o=n.children[r];r++)this.children.splice(i+r,0,o),o.parentNode=this;return n}},getAttr:function(e){return this.attrs&&this.attrs[e.toLowerCase()]},setAttr:function(e,t){if(e)if(this.attrs||(this.attrs={}),utils.isObject(e))for(var n in e)e[n]?this.attrs[n.toLowerCase()]=e[n]:delete this.attrs[n];else t?this.attrs[e.toLowerCase()]=t:delete this.attrs[e];else delete this.attrs},hasAttr:function(e){var t=this.getAttr(e);return null!=t},getIndex:function(){for(var e,t=this.parentNode,n=0;e=t.children[n];n++)if(e===this)return n;return-1},getNodeById:function(e){var t;if(this.children&&this.children.length)for(var n,i=0;n=this.children[i++];)if(t=function e(t,n){var i;if("element"==t.type&&t.getAttr("id")==n)return t;if(t.children&&t.children.length)for(var o,r=0;o=t.children[r++];)if(i=e(o,n))return i}(n,e))return t},getNodesByTagName:function(e){e=utils.trim(e).replace(/[ ]{2,}/g," ").split(" ");var i=[],o=this;return utils.each(e,function(e){if(o.children&&o.children.length)for(var t,n=0;t=o.children[n++];)!function e(t,n,i){if("element"==t.type&&t.tagName==n&&i.push(t),t.children&&t.children.length)for(var o,r=0;o=t.children[r++];)e(o,n,i)}(t,e,i)}),i},getStyle:function(e){var t=this.getAttr("style");if(!t)return"";var n=new RegExp("(^|;)\\s*"+e+":([^;]+)","i"),i=t.match(n);return i&&i[0]?i[2]:""},setStyle:function(e,t){function n(e,t){var n=new RegExp("(^|;)\\s*"+e+":([^;]+;?)","gi");i=i.replace(n,"$1"),t&&(i=e+":"+utils.unhtml(t)+";"+i)}var i=(i=this.getAttr("style"))||"";if(utils.isObject(e))for(var o in e)n(o,e[o]);else n(e,t);this.setAttr("style",utils.trim(i))},hasClass:function(n){if(this.hasAttr("class")){var e=this.getAttr("class").split(/\s+/),i=!1;return $.each(e,function(e,t){t===n&&(i=!0)}),i}return!1},addClass:function(t){var e=null,n=!1;this.hasAttr("class")?((e=(e=this.getAttr("class")).split(/\s+/)).forEach(function(e){e!==t||(n=!0)}),n||e.push(t),this.setAttr("class",e.join(" "))):this.setAttr("class",t)},removeClass:function(e){var t;this.hasAttr("class")&&(t=(t=this.getAttr("class")).replace(new RegExp("\\b"+e+"\\b","g"),""),this.setAttr("class",utils.trim(t).replace(/[ ]{2,}/g," ")))},traversal:function(e){return this.children&&this.children.length&&function e(t,n){if(t.children&&t.children.length)for(var i,o=0;i=t.children[o];)e(i,n),i.parentNode&&(i.children&&i.children.length&&n(i),i.parentNode&&o++);else n(t)}(this,e),this}};var htmlparser=UM.htmlparser=function(e,n){var t=/<(?:(?:\/([^>]+)>)|(?:!--([\S|\s]*?)-->)|(?:([^\s\/>]+)\s*((?:(?:"[^"]*")|(?:'[^']*')|[^"'<>])*)\/?>))/g,c=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,i={b:1,code:1,i:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,span:1,sub:1,img:1,sup:1,font:1,big:1,small:1,iframe:1,a:1,br:1,pre:1};e=e.replace(new RegExp(domUtils.fillChar,"g"),""),n||(e=e.replace(new RegExp("[\\r\\t\\n"+(n?"":" ")+"]*</?(\\w+)\\s*(?:[^>]*)>[\\r\\t\\n"+(n?"":" ")+"]*","g"),function(e,t){return t&&i[t.toLowerCase()]?e.replace(/(^[\n\r]+)|([\n\r]+$)/g,""):e.replace(new RegExp("^[\\r\\n"+(n?"":" ")+"]+"),"").replace(new RegExp("[\\r\\n"+(n?"":" ")+"]+$"),"")}));var u={href:1,src:1},h=UM.uNode,f={td:"tr",tr:["tbody","thead","tfoot"],tbody:"table",th:"tr",thead:"table",tfoot:"table",caption:"table",li:["ul","ol"],dt:"dl",dd:"dl",option:"select"},o={ol:"li",ul:"li"};function r(e,t){var n;o[e.tagName]?(n=h.createElement(o[e.tagName]),e.appendChild(n),n.appendChild(h.createText(t)),e=n):e.appendChild(h.createText(t))}for(var a,s,l,d,m=0,p=new h({type:"root",children:[]}),g=p;a=t.exec(e);){s=a.index;try{if(m<s&&r(g,e.slice(m,s)),a[3])dtd.$cdata[g.tagName]?r(g,a[0]):g=function e(t,n,i){var o;if(o=f[n]){for(var r,a=t;"root"!=a.type;){if(utils.isArray(o)?-1!=utils.indexOf(o,a.tagName):o==a.tagName){t=a,r=!0;break}a=a.parentNode}r||(t=e(t,utils.isArray(o)?o[0]:o))}var s=new h({parentNode:t,type:"element",tagName:n.toLowerCase(),children:dtd.$empty[n]?null:[]});if(i){for(var l,d={};l=c.exec(i);)d[l[1].toLowerCase()]=u[l[1].toLowerCase()]?l[2]||l[3]||l[4]:utils.unhtml(l[2]||l[3]||l[4]);s.attrs=d}return t.children.push(s),dtd.$empty[n]?t:s}(g,a[3].toLowerCase(),a[4]);else if(a[1]){if("root"!=g.type)if(dtd.$cdata[g.tagName]&&!dtd.$cdata[a[1]])r(g,a[0]);else{for(var b=g;"element"==g.type&&g.tagName!=a[1].toLowerCase();)if("root"==(g=g.parentNode).type)throw g=b,"break";g=g.parentNode}}else a[2]&&(l=g,d=a[2],l.children.push(new h({type:"comment",data:d,parentNode:l})))}catch(e){}m=t.lastIndex}return m<e.length&&r(g,e.slice(m)),p},filterNode=UM.filterNode=function(e,t){if(utils.isEmptyObject(t))return e;var n;(n=t["-"])&&utils.each(n.split(" "),function(e){t[e]="-"});for(var i,o=0;i=e.children[o];)!function e(n,t){switch(n.type){case"text":break;case"element":var i;if(i=t[n.tagName])if("-"===i)n.parentNode.removeChild(n);else if(utils.isFunction(i)){var o=n.parentNode,r=n.getIndex();if(i(n),n.parentNode){if(n.children)for(var a=0;h=n.children[a];)e(h,t),h.parentNode&&a++}else for(a=r;h=o.children[a];)e(h,t),h.parentNode&&a++}else{var s=i.$;if(s&&n.attrs){var l,d={};for(l in s){var c,u=n.getAttr(l);"style"==l&&utils.isArray(s[l])&&(c=[],utils.each(s[l],function(e){var t;(t=n.getStyle(e))&&c.push(e+":"+t)}),u=c.join(";")),u&&(d[l]=u)}n.attrs=d}if(n.children)for(a=0;h=n.children[a];)e(h,t),h.parentNode&&a++}else if(dtd.$cdata[n.tagName])n.parentNode.removeChild(n);else{o=n.parentNode,r=n.getIndex(),n.parentNode.removeChild(n,!0);for(var h,a=r;h=o.children[a];)e(h,t),h.parentNode&&a++}break;case"comment":n.parentNode.removeChild(n)}}(i,t),i.parentNode&&o++;return e},nu_textarea,yB,BB,sD,tD,uD,wD,xD,yD,zD,FE,GE,HE,IE,JE,KE;function LE(e){var t=this;if(!e)throw new Error("invalid params, notfound editor");t.editor=e,KE[e.uid]=this,e.addListener("destroy",function(){delete KE[e.uid],t.editor=null})}UM.commands.inserthtml={execCommand:function(e,t,n){var i,o,r,a=this;if(t&&!0!==a.fireEvent("beforeinserthtml",t)){if((r=(o=a.selection.getRange()).document.createElement("div")).style.display="inline",n||(i=UM.htmlparser(t),a.options.filterRules&&UM.filterNode(i,a.options.filterRules),a.filterInputRule(i),t=i.toHtml()),r.innerHTML=utils.trim(t),!o.collapsed){var s=o.startContainer;if(domUtils.isFillChar(s)&&o.setStartBefore(s),s=o.endContainer,domUtils.isFillChar(s)&&o.setEndAfter(s),o.txtToElmBoundary(),o.endContainer&&1==o.endContainer.nodeType&&(s=o.endContainer.childNodes[o.endOffset])&&domUtils.isBr(s)&&o.setEndAfter(s),0==o.startOffset&&(s=o.startContainer,domUtils.isBoundaryNode(s,"firstChild")&&(s=o.endContainer,o.endOffset==(3==s.nodeType?s.nodeValue.length:s.childNodes.length)&&domUtils.isBoundaryNode(s,"lastChild")&&(a.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>",o.setStart(a.body.firstChild,0).collapse(!0)))),o.collapsed||o.deleteContents(),1==o.startContainer.nodeType)if((l=o.startContainer.childNodes[o.startOffset])&&domUtils.isBlockElm(l)&&(p=l.previousSibling)&&domUtils.isBlockElm(p)){for(o.setEnd(p,p.childNodes.length).collapse();l.firstChild;)p.appendChild(l.firstChild);domUtils.remove(l)}}var l,d,c,u,h,f=0;for(o.inFillChar()&&(l=o.startContainer,domUtils.isFillChar(l)?(o.setStartBefore(l).collapse(!0),domUtils.remove(l)):domUtils.isFillChar(l,!0)&&(l.nodeValue=l.nodeValue.replace(fillCharReg,""),o.startOffset--,o.collapsed&&o.collapse(!0)));l=r.firstChild;){if(f){for(var m=a.document.createElement("p");l&&(3==l.nodeType||!dtd.$block[l.tagName]);)u=l.nextSibling,m.appendChild(l),l=u;m.firstChild&&(l=m)}if(o.insertNode(l),u=l.nextSibling,!f&&l.nodeType==domUtils.NODE_ELEMENT&&domUtils.isBlockElm(l)&&(d=domUtils.findParent(l,function(e){return domUtils.isBlockElm(e)}))&&"body"!=d.tagName.toLowerCase()&&(!dtd[d.tagName][l.nodeName]||l.parentNode!==d)){if(dtd[d.tagName][l.nodeName])for(c=l.parentNode;c!==d;)c=(p=c).parentNode;else p=d;domUtils.breakParent(l,p||c);var p=l.previousSibling;domUtils.trimWhiteTextNode(p),p.childNodes.length||domUtils.remove(p),!browser.ie&&(g=l.nextSibling)&&domUtils.isBlockElm(g)&&g.lastChild&&!domUtils.isBr(g.lastChild)&&g.appendChild(a.document.createElement("br")),f=1}var g=l.nextSibling;if(!r.firstChild&&g&&domUtils.isBlockElm(g)){o.setStart(g,0).collapse(!0);break}o.setEndAfter(l).collapse()}if(l=o.startContainer,u&&domUtils.isBr(u)&&domUtils.remove(u),domUtils.isBlockElm(l)&&domUtils.isEmptyNode(l))if(u=l.nextSibling)domUtils.remove(l),1==u.nodeType&&dtd.$block[u.tagName]&&o.setStart(u,0).collapse(!0).shrinkBoundary();else try{l.innerHTML=browser.ie?domUtils.fillChar:"<br/>"}catch(e){o.setStartBefore(l),domUtils.remove(l)}try{browser.ie9below&&1==o.startContainer.nodeType&&!o.startContainer.childNodes[o.startOffset]&&(p=o.startContainer.childNodes[o.startOffset-1])&&1==p.nodeType&&dtd.$empty[p.tagName]&&(h=this.document.createTextNode(domUtils.fillChar),o.insertNode(h).setStart(h,0).collapse(!0)),setTimeout(function(){o.select(!0)})}catch(e){}setTimeout(function(){(o=a.selection.getRange()).scrollIntoView(),a.fireEvent("afterinserthtml")},200)}}},UM.commands.insertimage={execCommand:function(e,t){if((t=utils.isArray(t)?t:[t]).length){var n=[],i="",o=t[0];if(1==t.length)i='<img src="'+o.src+'" '+(o._src?' _src="'+o._src+'" ':"")+(o.width?'width="'+o.width+'" ':"")+(o.height?' height="'+o.height+'" ':"")+("left"==o.floatStyle||"right"==o.floatStyle?' style="float:'+o.floatStyle+';"':"")+(o.title&&""!=o.title?' title="'+o.title+'"':"")+(o.border&&"0"!=o.border?' border="'+o.border+'"':"")+(o.alt&&""!=o.alt?' alt="'+o.alt+'"':"")+(o.hspace&&"0"!=o.hspace?' hspace = "'+o.hspace+'"':"")+(o.vspace&&"0"!=o.vspace?' vspace = "'+o.vspace+'"':"")+"/>","center"==o.floatStyle&&(i='<p style="text-align: center">'+i+"</p>"),n.push(i);else for(var r=0;o=t[r++];)i="<p "+("center"==o.floatStyle?'style="text-align: center" ':"")+'><img src="'+o.src+'" '+(o.width?'width="'+o.width+'" ':"")+(o._src?' _src="'+o._src+'" ':"")+(o.height?' height="'+o.height+'" ':"")+' style="'+(o.floatStyle&&"center"!=o.floatStyle?"float:"+o.floatStyle+";":"")+(o.border||"")+'" '+(o.title?' title="'+o.title+'"':"")+" /></p>",n.push(i);this.execCommand("insertHtml",n.join(""),!0)}}},UM.plugins.justify=function(){var n=this;$.each("justifyleft justifyright justifycenter justifyfull".split(" "),function(e,t){n.commands[t]={execCommand:function(e){return this.document.execCommand(e)},queryCommandValue:function(e){var t=this.document.queryCommandValue(e);return!0===t||"true"===t?e.replace(/justify/,""):""},queryCommandState:function(e){return this.document.queryCommandState(e)?1:0}}})},UM.plugins.font=function(){var e,i=this,a={forecolor:"forecolor",backcolor:"backcolor",fontsize:"fontsize",fontfamily:"fontname"},s={forecolor:"color",backcolor:"background-color",fontsize:"font-size",fontfamily:"font-family"},o={forecolor:"color",fontsize:"size",fontfamily:"face"};for(e in i.setOpt({fontfamily:[{name:"songti",val:"宋体,SimSun"},{name:"yahei",val:"微软雅黑,Microsoft YaHei"},{name:"kaiti",val:"楷体,楷体_GB2312, SimKai"},{name:"heiti",val:"黑体, SimHei"},{name:"lishu",val:"隶书, SimLi"},{name:"andaleMono",val:"andale mono"},{name:"arial",val:"arial, helvetica,sans-serif"},{name:"arialBlack",val:"arial black,avant garde"},{name:"comicSansMs",val:"comic sans ms"},{name:"impact",val:"impact,chicago"},{name:"timesNewRoman",val:"times new roman"},{name:"sans-serif",val:"sans-serif"}],fontsize:[10,12,16,18,24,32,48]}),i.addOutputRule(function(e){utils.each(e.getNodesByTagName("font"),function(n){if("font"==n.tagName){var e,t=[];for(e in n.attrs)switch(e){case"size":var i=n.attrs[e];$.each({10:"1",12:"2",16:"3",18:"4",24:"5",32:"6",48:"7"},function(e,t){if(t==i)return i=e,!1}),t.push("font-size:"+i+"px");break;case"color":t.push("color:"+n.attrs[e]);break;case"face":t.push("font-family:"+n.attrs[e]);break;case"style":t.push(n.attrs[e])}n.attrs={style:t.join(";")}}(n.tagName="span")==n.parentNode.tagName&&1==n.parentNode.children.length&&($.each(n.attrs,function(e,t){n.parentNode.attrs[e]="style"==e?n.parentNode.attrs[e]+t:t}),n.parentNode.removeChild(n,!0))})}),a)i.commands[e]={execCommand:function(e,t){if("transparent"!=t){var n,i,o=this.selection.getRange();if(!o.collapsed)return"fontsize"==e&&(t={10:"1",12:"2",16:"3",18:"4",24:"5",32:"6",48:"7"}[(t+"").replace(/px/,"")]),this.document.execCommand(a[e],!1,t),browser.gecko&&$.each(this.$body.find("a"),function(e,t){var n,i=t.parentNode;i.lastChild===i.firstChild&&/FONT|SPAN/.test(i.tagName)&&((n=i.cloneNode(!1)).innerHTML=t.innerHTML,$(t).html("").append(n).insertBefore(i),$(i).remove())}),browser.ie||(n=this.selection.getNative().getRangeAt(0).commonAncestorContainer,i=(o=this.selection.getRange()).createBookmark(!0),$(n).find("a").each(function(e,t){var n,i=t.parentNode;"FONT"==i.nodeName&&((n=i.cloneNode(!1)).innerHTML=t.innerHTML,$(t).html("").append(n))}),o.moveToBookmark(i).select()),!0;var r=$("<span></span>").css(s[e],t)[0];o.insertNode(r).setStart(r,0).setCursor()}},queryCommandValue:function(e){var t=i.selection.getStart(),n=$(t).css(s[e]);return void 0===n&&(n=$(t).attr(o[e])),n?utils.fixColor(e,n).replace(/px/,""):""},queryCommandState:function(e){return this.queryCommandValue(e)}}},UM.plugins.link=function(){this.setOpt("autourldetectinie",!1),browser.ie&&!1===this.options.autourldetectinie&&this.addListener("keyup",function(e,t){var n,i,o=t.keyCode;13!=o&&32!=o||(n=this.selection.getRange().startContainer,13==o?"P"!=n.nodeName||(i=n.previousSibling)&&1==i.nodeType&&(i=i.lastChild)&&"A"==i.nodeName&&!i.getAttribute("_href")&&domUtils.remove(i,!0):32==o&&3==n.nodeType&&/^\s$/.test(n.nodeValue)&&(n=n.previousSibling)&&"A"==n.nodeName&&!n.getAttribute("_href")&&domUtils.remove(n,!0))}),this.addOutputRule(function(e){$.each(e.getNodesByTagName("a"),function(e,t){var n=utils.html(t.getAttr("_href"));/^(ftp|https?|\/|file)/.test(n)||(n="http://"+n),t.setAttr("href",n),t.setAttr("_href"),""==t.getAttr("title")&&t.setAttr("title")})}),this.addInputRule(function(e){$.each(e.getNodesByTagName("a"),function(e,t){t.setAttr("_href",utils.html(t.getAttr("href")))})}),this.commands.link={execCommand:function(e,t){var n,i=this.selection.getRange();i.collapsed?(n=i.startContainer,(n=domUtils.findParentByTagName(n,"a",!0))?($(n).attr(t),i.selectNode(n).select()):i.insertNode($("<a>"+t.href+"</a>").attr(t)[0]).select()):(this.document.execCommand("createlink",!1,"_umeditor_link"),utils.each(domUtils.getElementsByTagName(this.body,"a",function(e){return"_umeditor_link"==e.getAttribute("href")}),function(e){"_umeditor_link"==$(e).text()&&$(e).text(t.href),domUtils.setAttributes(e,t),i.selectNode(e).select()}))},queryCommandState:function(){return this.queryCommandValue("link")?1:0},queryCommandValue:function(){var n,e=this.selection.getStartElementPath();return $.each(e,function(e,t){if("A"==t.nodeName)return n=t,!1}),n}},this.commands.unlink={execCommand:function(){this.document.execCommand("unlink")}}},UM.commands.print={execCommand:function(){var e="editor_print_"+ +new Date;$('<iframe src="" id="'+e+'" name="'+e+'" frameborder="0"></iframe>').attr("id",e).css({width:"0px",height:"0px",overflow:"hidden",float:"left",position:"absolute",top:"-10000px",left:"-10000px"}).appendTo(this.$container.find(".edui-dialog-container"));var t=window.open("",e,"").document;t.open(),t.write("<html><head></head><body><div>"+this.getContent(null,null,!0)+"</div><script>setTimeout(function(){window.print();setTimeout(function(){window.parent.$('#"+e+"').remove();},100);},200);<\/script></body></html>"),t.close()},notNeedUndo:1},UM.plugins.paragraph=function(){this.setOpt("paragraph",{p:"",h1:"",h2:"",h3:"",h4:"",h5:"",h6:""}),this.commands.paragraph={execCommand:function(e,t){return this.document.execCommand("formatBlock",!1,"<"+t+">")},queryCommandValue:function(){try{var e=this.document.queryCommandValue("formatBlock")}catch(e){}return e}}},UM.plugins.horizontal=function(){var a=this;a.commands.horizontal={execCommand:function(){this.document.execCommand("insertHorizontalRule");var e,t,n=a.selection.getRange().txtToElmBoundary(!0),i=n.startContainer;if(domUtils.isBody(n.startContainer)){var o=(o=n.startContainer.childNodes[n.startOffset])||$("<p></p>").appendTo(n.startContainer).html(browser.ie?"&nbsp;":"<br/>")[0];n.setStart(o,0).setCursor()}else{for(;dtd.$inline[i.tagName]&&i.lastChild===i.firstChild;){var r=i.parentNode;r.appendChild(i.firstChild),r.removeChild(i),i=r}for(;dtd.$inline[i.tagName];)i=i.parentNode;1==i.childNodes.length&&"HR"==i.lastChild.nodeName?(e=i.lastChild,$(e).insertBefore(i),n.setStart(i,0).setCursor()):(e=$("hr",i)[0],domUtils.breakParent(e,i),(t=e.previousSibling)&&domUtils.isEmptyBlock(t)&&$(t).remove(),n.setStart(e.nextSibling,0).setCursor())}}}},UM.commands.cleardoc={execCommand:function(){var e=this,t=e.selection.getRange();e.body.innerHTML="<p>"+(ie?"":"<br/>")+"</p>",t.setStart(e.body.firstChild,0).setCursor(!1,!0),setTimeout(function(){e.fireEvent("clearDoc")},0)}},UM.plugins.undo=function(){var a,e=this,s=e.options.maxUndoCount||20,r=e.options.maxInputCount||20,l=new RegExp(domUtils.fillChar+"|</hr>","gi"),d={ol:1,ul:1,table:1,tbody:1,tr:1,body:1},c=e.options.autoClearEmptyNode;function u(e,t){if(e.length==t.length){for(var n=0,i=e.length;n<i;n++)if(e[n]!=t[n])return;return 1}}function t(){this.undoManger.save()}e.undoManger=new function(){this.list=[],this.index=0,this.hasUndo=!1,this.hasRedo=!1,this.undo=function(){if(this.hasUndo){if(!this.list[this.index-1]&&1==this.list.length)return void this.reset();for(;this.list[this.index].content==this.list[this.index-1].content;)if(this.index--,0==this.index)return this.restore(0);this.restore(--this.index)}},this.redo=function(){if(this.hasRedo){for(;this.list[this.index].content==this.list[this.index+1].content;)if(this.index++,this.index==this.list.length-1)return this.restore(this.index);this.restore(++this.index)}},this.restore=function(){var t=this.editor,e=this.list[this.index],n=UM.htmlparser(e.content.replace(l,""));t.options.autoClearEmptyNode=!1,t.filterInputRule(n,!0),t.options.autoClearEmptyNode=c,t.body.innerHTML=n.toHtml(),t.fireEvent("afterscencerestore"),browser.ie&&utils.each(domUtils.getElementsByTagName(t.document,"td th caption p"),function(e){domUtils.isEmptyNode(e)&&domUtils.fillNode(t.document,e)});try{var i,o=new dom.Range(t.document,t.body).moveToAddress(e.address);browser.ie&&o.collapsed&&1==o.startContainer.nodeType&&((!(i=o.startContainer.childNodes[o.startOffset])||1==i.nodeType&&dtd.$empty[i])&&o.insertNode(t.document.createTextNode(" ")).collapse(!0)),o.select(d[o.startContainer.nodeName.toLowerCase()])}catch(e){}this.update(),this.clearKey(),t.fireEvent("reset",!0)},this.getScene=function(){var e=this.editor,t=e.selection.getRange().createAddress(!1,!0);e.fireEvent("beforegetscene");var n=UM.htmlparser(e.body.innerHTML,!0);e.options.autoClearEmptyNode=!1,e.filterOutputRule(n,!0),e.options.autoClearEmptyNode=c;var i=n.toHtml();return browser.ie&&(i=i.replace(/>&nbsp;</g,"><").replace(/\s*</g,"<").replace(/>\s*/g,">")),e.fireEvent("aftergetscene"),{address:t,content:i}},this.save=function(e,t){clearTimeout(a);var n,i,o=this.getScene(t),r=this.list[this.index];r&&r.content==o.content&&(e||(n=r.address,i=o.address,n.collapsed==i.collapsed&&u(n.startAddress,i.startAddress)&&u(n.endAddress,i.endAddress)))||(this.list=this.list.slice(0,this.index+1),this.list.push(o),this.list.length>s&&this.list.shift(),this.index=this.list.length-1,this.clearKey(),this.update())},this.update=function(){this.hasRedo=!!this.list[this.index+1],this.hasUndo=!!this.list[this.index-1]},this.reset=function(){this.list=[],this.index=0,this.hasUndo=!1,this.hasRedo=!1,this.clearKey()},this.clearKey=function(){f=0,0}},(e.undoManger.editor=e).addListener("saveScene",function(){var e=Array.prototype.splice.call(arguments,1);this.undoManger.save.apply(this.undoManger,e)}),e.addListener("beforeexeccommand",t),e.addListener("afterexeccommand",t),e.addListener("reset",function(e,t){t||this.undoManger.reset()}),e.commands.redo=e.commands.undo={execCommand:function(e){this.undoManger[e]()},queryCommandState:function(e){return this.undoManger["has"+("undo"==e.toLowerCase()?"Undo":"Redo")]?0:-1},notNeedUndo:1};var h={16:1,17:1,18:1,37:1,38:1,39:1,40:1},f=0,m=!1;e.addListener("ready",function(){$(this.body).on("compositionstart",function(){m=!0}).on("compositionend",function(){m=!1})}),e.addshortcutkey({Undo:"ctrl+90",Redo:"ctrl+89,shift+ctrl+z"});var p=!0;e.addListener("keydown",function(e,t){var n=this,i=t.keyCode||t.which;if(!(h[i]||t.ctrlKey||t.metaKey||t.shiftKey||t.altKey)){if(m)return;if(!n.selection.getRange().collapsed)return n.undoManger.save(!1,!0),void(p=!1);function o(e){e.selection.getRange().collapsed&&e.fireEvent("contentchange"),e.undoManger.save(!1,!0),e.fireEvent("selectionchange")}0==n.undoManger.list.length&&n.undoManger.save(!0),clearTimeout(a),a=setTimeout(function(){var e;m?e=setInterval(function(){m||(o(n),clearInterval(e))},300):o(n)},200),r<=++f&&o(n)}}),e.addListener("keyup",function(e,t){var n=t.keyCode||t.which;if(!(h[n]||t.ctrlKey||t.metaKey||t.shiftKey||t.altKey)){if(m)return;p||(this.undoManger.save(!1,!0),p=!0)}})},UM.plugins.paste=function(){var b=this;b.addListener("ready",function(){$(b.body).on("cut",function(){!b.selection.getRange().collapsed&&b.undoManger&&b.undoManger.save()}).on(browser.ie||browser.opera?"keydown":"paste",function(e){(!browser.ie&&!browser.opera||(e.ctrlKey||e.metaKey)&&"86"==e.keyCode)&&function(i){var o,r,a,s=this.document;s.getElementById("baidu_pastebin")||(o=this.selection.getRange(),r=o.createBookmark(),(a=s.createElement("div")).id="baidu_pastebin",browser.webkit&&a.appendChild(s.createTextNode(domUtils.fillChar+domUtils.fillChar)),this.body.appendChild(a),r.start.style.display="",a.style.cssText="position:absolute;width:1px;height:1px;overflow:hidden;left:-1000px;white-space:nowrap;top:"+$(r.start).position().top+"px",o.selectNodeContents(a).select(!0),setTimeout(function(){if(browser.webkit)for(var e,t=0,n=s.querySelectorAll("#baidu_pastebin");e=n[t++];){if(!domUtils.isEmptyNode(e)){a=e;break}domUtils.remove(e)}try{a.parentNode.removeChild(a)}catch(e){}o.moveToBookmark(r).select(!0),i(a)},0))}.call(b,function(e){!function(e){var t;if(e.firstChild){for(var n,i=domUtils.getElementsByTagName(e,"span"),o=0;n=i[o++];)"_baidu_cut_start"!=n.id&&"_baidu_cut_end"!=n.id||domUtils.remove(n);if(browser.webkit){for(var r,a=e.querySelectorAll("div br"),o=0;r=a[o++];){var s=r.parentNode;"DIV"==s.tagName&&1==s.childNodes.length&&(s.innerHTML="<p><br/></p>",domUtils.remove(s))}for(var l,d=e.querySelectorAll("#baidu_pastebin"),o=0;l=d[o++];){var c=b.document.createElement("p");for(l.parentNode.insertBefore(c,l);l.firstChild;)c.appendChild(l.firstChild);domUtils.remove(l)}for(var u=e.querySelectorAll("meta"),o=0;f=u[o++];)domUtils.remove(f);a=e.querySelectorAll("br");for(o=0;f=a[o++];)/^apple-/i.test(f.className)&&domUtils.remove(f)}if(browser.gecko){var h=e.querySelectorAll("[_moz_dirty]");for(o=0;f=h[o++];)f.removeAttribute("_moz_dirty")}if(!browser.ie)for(var f,m=e.querySelectorAll("span.Apple-style-span"),o=0;f=m[o++];)domUtils.remove(f,!0);t=e.innerHTML,t=UM.filterWord(t);var p,g=UM.htmlparser(t);if(b.options.filterRules&&UM.filterNode(g,b.options.filterRules),b.filterInputRule(g),browser.webkit&&((p=g.lastChild())&&"element"==p.type&&"br"==p.tagName&&g.removeChild(p),utils.each(b.body.querySelectorAll("div"),function(e){domUtils.isEmptyBlock(e)&&domUtils.remove(e)})),t={html:g.toHtml()},b.fireEvent("beforepaste",t,g),!t.html)return;b.execCommand("insertHtml",t.html,!0),b.fireEvent("afterpaste",t)}}(e)})})})},UM.plugins.list=function(){this.setOpt({insertorderedlist:{decimal:"","lower-alpha":"","lower-roman":"","upper-alpha":"","upper-roman":""},insertunorderedlist:{circle:"",disc:"",square:""}}),this.addInputRule(function(e){utils.each(e.getNodesByTagName("li"),function(e){0==e.children.length&&e.parentNode.removeChild(e)})}),this.commands.insertorderedlist=this.commands.insertunorderedlist={execCommand:function(e){this.document.execCommand(e);var t=this.selection.getRange(),n=t.createBookmark(!0);return this.$body.find("ol,ul").each(function(e,t){var i=t.parentNode;"P"==i.tagName&&i.lastChild===i.firstChild&&($(t).children().each(function(e,t){var n=i.cloneNode(!1);$(n).append(t.innerHTML),$(t).html("").append(n)}),$(t).insertBefore(i),$(i).remove()),dtd.$inline[i.tagName]&&("SPAN"==i.tagName&&$(t).children().each(function(e,t){var n=i.cloneNode(!1);if("P"!=t.firstChild.nodeName){for(;t.firstChild;)n.appendChild(t.firstChild);$("<p></p>").appendTo(t).append(n)}else{for(;t.firstChild;)n.appendChild(t.firstChild);$(t.firstChild).append(n)}}),domUtils.remove(i,!0))}),t.moveToBookmark(n).select(),!0},queryCommandState:function(e){return this.document.queryCommandState(e)}}},nu_textarea=function(e,t){var n=t.ownerDocument.createElement("textarea");return n.style.cssText="resize:none;border:0;padding:0;margin:0;overflow-y:auto;outline:0",browser.ie&&browser.version<8&&(n.style.width=t.offsetWidth+"px",n.style.height=t.offsetHeight+"px",t.onresize=function(){n.style.width=t.offsetWidth+"px",n.style.height=t.offsetHeight+"px"}),t.appendChild(n),{container:n,setContent:function(e){n.value=e},getContent:function(){return n.value},select:function(){var e;browser.ie?((e=n.createTextRange()).collapse(!0),e.select()):(n.setSelectionRange(0,0),n.focus())},dispose:function(){t.removeChild(n),t.onresize=null,t=n=null}}},UM.plugins.source=function(){var r,a=this,e=this.options,s=!1;e.sourceEditor="textarea",a.setOpt({sourceEditorFirst:!1});var l,d=a.getContent;a.commands.source={execCommand:function(){if(s=!s){l=a.selection.getRange().createAddress(!1,!0),a.undoManger&&a.undoManger.save(!0),browser.gecko&&(a.body.contentEditable=!1),a.body.style.cssText+=";position:absolute;left:-32768px;top:-32768px;",a.fireEvent("beforegetcontent");var e=UM.htmlparser(a.body.innerHTML);a.filterOutputRule(e),e.traversal(function(e){if("element"==e.type)switch(e.tagName){case"td":case"th":case"caption":e.children&&1==e.children.length&&"br"==e.firstChild().tagName&&e.removeChild(e.firstChild());break;case"pre":e.innerText(e.innerText().replace(/&nbsp;/g," "))}}),a.fireEvent("aftergetcontent");var t=e.toHtml(!0);o=a.body.parentNode,(r=nu_textarea(a,o)).setContent(t);function n(e){return parseInt($(a.body).css(e))}$(r.container).width($(a.body).width()+n("padding-left")+n("padding-right")).height($(a.body).height()),setTimeout(function(){r.select()}),a.getContent=function(){return r.getContent()||"<p>"+(browser.ie?"":"<br/>")+"</p>"}}else{a.$body.css({position:"",left:"",top:""});var i=(i=r.getContent()||"<p>"+(browser.ie?"":"<br/>")+"</p>").replace(new RegExp("[\\r\\t\\n ]*</?(\\w+)\\s*(?:[^>]*)>","g"),function(e,t){return t&&!dtd.$inlineWithA[t.toLowerCase()]?e.replace(/(^[\n\r\t ]*)|([\n\r\t ]*$)/g,""):e.replace(/(^[\n\r\t]*)|([\n\r\t]*$)/g,"")});a.setContent(i),r.dispose(),r=null,a.getContent=d,a.body.firstChild||(a.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>"),a.undoManger&&a.undoManger.save(!0),browser.gecko&&(a.body.contentEditable=!0);try{a.selection.getRange().moveToAddress(l).select()}catch(e){}}var o;this.fireEvent("sourcemodechanged",s)},queryCommandState:function(){return 0|s},notNeedUndo:1};var t=a.queryCommandState;a.queryCommandState=function(e){return e=e.toLowerCase(),!s||e in{source:1,fullscreen:1}?t.apply(this,arguments):-1}},UM.plugins.enterkey=function(){var l,d=this,s=d.options.enterTag;d.addListener("keyup",function(e,t){if(13==(t.keyCode||t.which)){var n,i=d.selection.getRange(),o=i.startContainer;if(browser.ie)d.fireEvent("saveScene",!0,!0);else{if(/h\d/i.test(l)){if(browser.gecko)domUtils.findParentByTagName(o,["h1","h2","h3","h4","h5","h6","blockquote","caption","table"],!0)||(d.document.execCommand("formatBlock",!1,"<p>"),n=1);else if(1==o.nodeType){var r,a=d.document.createTextNode("");if(i.insertNode(a),r=domUtils.findParentByTagName(a,"div",!0)){for(var s=d.document.createElement("p");r.firstChild;)s.appendChild(r.firstChild);r.parentNode.insertBefore(s,r),domUtils.remove(r),i.setStartBefore(a).setCursor(),n=1}domUtils.remove(a)}d.undoManger&&n&&d.undoManger.save()}browser.opera&&i.select()}}}),d.addListener("keydown",function(e,t){if(13==(t.keyCode||t.which)){if(d.fireEvent("beforeenterkeydown"))return void domUtils.preventDefault(t);d.fireEvent("saveScene",!0,!0),l="";var n=d.selection.getRange();if(!n.collapsed){var i=n.startContainer,o=n.endContainer,r=domUtils.findParentByTagName(i,"td",!0),a=domUtils.findParentByTagName(o,"td",!0);if(r&&a&&r!==a||!r&&a||r&&!a)return void(t.preventDefault?t.preventDefault():t.returnValue=!1)}"p"==s&&(browser.ie||((i=domUtils.findParentByTagName(n.startContainer,["ol","ul","p","h1","h2","h3","h4","h5","h6","blockquote","caption"],!0))||browser.opera?(l=i.tagName,"p"==i.tagName.toLowerCase()&&browser.gecko&&domUtils.removeDirtyAttr(i)):(d.document.execCommand("formatBlock",!1,"<p>"),browser.gecko&&(n=d.selection.getRange(),(i=domUtils.findParentByTagName(n.startContainer,"p",!0))&&domUtils.removeDirtyAttr(i)))))}}),browser.ie&&d.addListener("setDisabled",function(){$(d.body).find("p").each(function(e,t){domUtils.isEmptyBlock(t)&&(t.innerHTML="&nbsp;")})})},UM.commands.preview={execCommand:function(){var e=window.open("","_blank","").document,t=this.getContent(null,null,!0),n=this.getOpt("UMEDITOR_HOME_URL"),i=-1!=t.indexOf("mathquill-embedded-latex")?'<link rel="stylesheet" href="'+n+'third-party/mathquill/mathquill.css"/><script src="'+n+'third-party/jquery.min.js"><\/script><script src="'+n+'third-party/mathquill/mathquill.min.js"><\/script>':"";e.open(),e.write("<html><head>"+i+"</head><body><div>"+t+"</div></body></html>"),e.close()},notNeedUndo:1},UM.plugins.basestyle=function(){var n=this;n.addshortcutkey({Bold:"ctrl+66",Italic:"ctrl+73",Underline:"ctrl+shift+85",strikeThrough:"ctrl+shift+83"}),n.addOutputRule(function(e){$.each(e.getNodesByTagName("b i u strike s"),function(e,t){switch(t.tagName){case"b":t.tagName="strong";break;case"i":t.tagName="em";break;case"u":t.tagName="span",t.setStyle("text-decoration","underline");break;case"s":case"strike":t.tagName="span",t.setStyle("text-decoration","line-through")}})}),$.each(["bold","underline","superscript","subscript","italic","strikethrough"],function(e,t){n.commands[t]={execCommand:function(e){var t=this.selection.getRange();if(t.collapsed&&1!=this.queryCommandState(e)){var n=this.document.createElement({bold:"strong",underline:"u",superscript:"sup",subscript:"sub",italic:"em",strikethrough:"strike"}[e]);return t.insertNode(n).setStart(n,0).setCursor(!1),!0}return this.document.execCommand(e)},queryCommandState:function(n){if(browser.gecko)return this.document.queryCommandState(n);var e=this.selection.getStartElementPath(),i=!1;return $.each(e,function(e,t){switch(n){case"bold":if("STRONG"==t.nodeName||"B"==t.nodeName)return!(i=1);break;case"underline":if("U"==t.nodeName||"SPAN"==t.nodeName&&"underline"==$(t).css("text-decoration"))return!(i=1);break;case"superscript":if("SUP"==t.nodeName)return!(i=1);break;case"subscript":if("SUB"==t.nodeName)return!(i=1);break;case"italic":if("EM"==t.nodeName||"I"==t.nodeName)return!(i=1);break;case"strikethrough":if("S"==t.nodeName||"STRIKE"==t.nodeName||"SPAN"==t.nodeName&&"line-through"==$(t).css("text-decoration"))return!(i=1)}}),i}}})},UM.plugins.video=function(){var a=this;function s(e,t,n,i,o,r){return r?'<video controls="controls" src="'+e+'" width="'+t+'" height="'+n+'"'+(o?' style="float:'+o+'"':"")+" />":"<img "+(i?'id="'+i+'"':"")+' width="'+t+'" height="'+n+'" _url="'+e+'" class="edui-faked-video" src="'+a.options.UMEDITOR_HOME_URL+'themes/default/images/spacer.gif" style="background:url('+a.options.UMEDITOR_HOME_URL+"themes/default/images/videologo.gif) no-repeat center center; border:1px solid gray;"+(o?"float:"+o+";":"")+'" />'}function t(e,n){utils.each(e.getNodesByTagName(n?"img":"embed"),function(e){var t;"edui-faked-video"==e.getAttr("class")&&(t=s(n?e.getAttr("_url"):e.getAttr("src"),e.getAttr("width"),e.getAttr("height"),null,e.getStyle("float")||"",n),e.parentNode.replaceChild(UM.uNode.createElement(t),e))})}a.addOutputRule(function(e){t(e,!0)}),a.addInputRule(function(e){t(e)}),a.commands.insertvideo={execCommand:function(e,t){for(var n,i=[],o=0,r=(t=utils.isArray(t)?t:[t]).length;o<r;o++)n=t[o],i.push(s(n.url,n.width||420,n.height||280,"tmpVedio"+o,n.align,!1));a.execCommand("inserthtml",i.join(""),!0)},queryCommandState:function(){var e=a.selection.getRange().getClosedNode();return e&&"edui-faked-video"==e.className?1:0}}},UM.plugins.selectall=function(){this.commands.selectall={execCommand:function(){var e=this.body,t=this.selection.getRange();t.selectNodeContents(e),domUtils.isEmptyBlock(e)&&(browser.opera&&e.firstChild&&1==e.firstChild.nodeType&&t.setStartAtFirst(e.firstChild),t.collapse(!0)),t.select(!0)},notNeedUndo:1},this.addshortcutkey({selectAll:"ctrl+65"})},UM.plugins.removeformat=function(){this.setOpt({removeFormatTags:"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var",removeFormatAttributes:"class,style,lang,width,height,align,hspace,valign"}),this.commands.removeformat={execCommand:function(e,t,d,n,c){var u,h,f=new RegExp("^(?:"+(t||this.options.removeFormatTags).replace(/,/g,"|")+")$","i"),m=d?[]:(n||this.options.removeFormatAttributes).split(","),i=new dom.Range(this.document),p=function(e){return 1==e.nodeType};function g(e){if(3!=e.nodeType&&"span"==e.tagName.toLowerCase()){if(browser.ie){var t=e.attributes;if(t.length){for(var n=0,i=t.length;n<i;n++)if(t[n].specified)return;return 1}}return!e.attributes.length}}(i=this.selection.getRange()).collapsed||(function(e){var t,n=e.createBookmark();for(e.collapsed&&e.enlarge(!0),c||((t=domUtils.findParentByTagName(e.startContainer,"a",!0))&&e.setStartBefore(t),(t=domUtils.findParentByTagName(e.endContainer,"a",!0))&&e.setEndAfter(t)),s=(u=e.createBookmark()).start;(h=s.parentNode)&&!domUtils.isBlockElm(h);)domUtils.breakParent(s,h),domUtils.clearEmptySibling(s);if(u.end){for(s=u.end;(h=s.parentNode)&&!domUtils.isBlockElm(h);)domUtils.breakParent(s,h),domUtils.clearEmptySibling(s);for(var i,o=domUtils.getNextDomNode(u.start,!1,p);o&&o!=u.end;)i=domUtils.getNextDomNode(o,!0,p),dtd.$empty[o.tagName.toLowerCase()]||domUtils.isBookmarkNode(o)||(f.test(o.tagName)?d?(domUtils.removeStyle(o,d),g(o)&&"text-decoration"!=d&&domUtils.remove(o,!0)):domUtils.remove(o,!0):dtd.$tableContent[o.tagName]||dtd.$list[o.tagName]||(domUtils.removeAttributes(o,m),g(o)&&domUtils.remove(o,!0))),o=i}var r=u.start.parentNode;!domUtils.isBlockElm(r)||dtd.$tableContent[r.tagName]||dtd.$list[r.tagName]||domUtils.removeAttributes(r,m),r=u.end.parentNode,u.end&&domUtils.isBlockElm(r)&&!dtd.$tableContent[r.tagName]&&!dtd.$list[r.tagName]&&domUtils.removeAttributes(r,m),e.moveToBookmark(u).moveToBookmark(n);for(var a,s=e.startContainer,l=e.collapsed;1==s.nodeType&&domUtils.isEmptyNode(s)&&dtd.$removeEmpty[s.tagName];)a=s.parentNode,e.setStartBefore(s),e.startContainer===e.endContainer&&e.endOffset--,domUtils.remove(s),s=a;if(!l)for(s=e.endContainer;1==s.nodeType&&domUtils.isEmptyNode(s)&&dtd.$removeEmpty[s.tagName];)a=s.parentNode,e.setEndBefore(s),domUtils.remove(s),s=a}(i),i.select())}}},UM.plugins.keystrokes=function(){var u=this,h=!0;u.addListener("keydown",function(e,t){var n,i,o,r=t.keyCode||t.which,a=u.selection.getRange();if(!a.collapsed&&!(t.ctrlKey||t.shiftKey||t.altKey||t.metaKey)&&(65<=r&&r<=90||48<=r&&r<=57||96<=r&&r<=111||{13:1,8:1,46:1}[r])){var s=a.startContainer;if(domUtils.isFillChar(s)&&a.setStartBefore(s),s=a.endContainer,domUtils.isFillChar(s)&&a.setEndAfter(s),a.txtToElmBoundary(),a.endContainer&&1==a.endContainer.nodeType&&(s=a.endContainer.childNodes[a.endOffset])&&domUtils.isBr(s)&&a.setEndAfter(s),0==a.startOffset&&(s=a.startContainer,domUtils.isBoundaryNode(s,"firstChild")&&(s=a.endContainer,a.endOffset==(3==s.nodeType?s.nodeValue.length:s.childNodes.length)&&domUtils.isBoundaryNode(s,"lastChild"))))return u.fireEvent("saveScene"),u.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>",a.setStart(u.body.firstChild,0).setCursor(!1,!0),void u._selectionChange()}if(8==r){if(a=u.selection.getRange(),h=a.collapsed,u.fireEvent("delkeydown",t))return;if(a.collapsed&&a.inFillChar()&&(n=a.startContainer,domUtils.isFillChar(n)?(a.setStartBefore(n).shrinkBoundary(!0).collapse(!0),domUtils.remove(n)):(n.nodeValue=n.nodeValue.replace(new RegExp("^"+domUtils.fillChar),""),a.startOffset--,a.collapse(!0).select(!0))),n=a.getClosedNode())return u.fireEvent("saveScene"),a.setStartBefore(n),domUtils.remove(n),a.setCursor(),u.fireEvent("saveScene"),void domUtils.preventDefault(t);if(!browser.ie&&(n=domUtils.findParentByTagName(a.startContainer,"table",!0),i=domUtils.findParentByTagName(a.endContainer,"table",!0),n&&!i||!n&&i||n!==i))return void t.preventDefault();if(n=a.startContainer,!a.collapsed||1!=n.nodeType||(o=n.childNodes[a.startOffset-1])&&1==o.nodeType&&"BR"==o.tagName&&(u.fireEvent("saveScene"),a.setStartBefore(o).collapse(!0),domUtils.remove(o),a.select(),u.fireEvent("saveScene")),browser.chrome&&a.collapsed){for(;0==a.startOffset&&!domUtils.isEmptyBlock(a.startContainer);)a.setStartBefore(a.startContainer);var l=a.startContainer.childNodes[a.startOffset-1];l&&"BR"==l.nodeName&&(a.setStartBefore(l),u.fireEvent("saveScene"),$(l).remove(),a.setCursor(),u.fireEvent("saveScene"))}}if(browser.gecko&&46==r){var d=u.selection.getRange();if(d.collapsed&&(n=d.startContainer,domUtils.isEmptyBlock(n))){for(var c=n.parentNode;1==domUtils.getChildCount(c)&&!domUtils.isBody(c);)c=(n=c).parentNode;return void(n===c.lastChild&&t.preventDefault())}}}),u.addListener("keyup",function(e,t){var n,i;if(8==(t.keyCode||t.which)){if(this.fireEvent("delkeyup"))return;if((n=this.selection.getRange()).collapsed){var o;if((o=domUtils.findParentByTagName(n.startContainer,["h1","h2","h3","h4","h5","h6"],!0))&&domUtils.isEmptyBlock(o)){var r=o.previousSibling;if(r&&"TABLE"!=r.nodeName)return domUtils.remove(o),void n.setStartAtLast(r).setCursor(!1,!0);var a=o.nextSibling;if(a&&"TABLE"!=a.nodeName)return domUtils.remove(o),void n.setStartAtFirst(a).setCursor(!1,!0)}domUtils.isBody(n.startContainer)&&(o=domUtils.createElement(this.document,"p",{innerHTML:browser.ie?domUtils.fillChar:"<br/>"}),n.insertNode(o).setStart(o,0).setCursor(!1,!0))}!h&&(3==n.startContainer.nodeType||1==n.startContainer.nodeType&&domUtils.isEmptyBlock(n.startContainer))&&(browser.ie?(i=n.document.createElement("span"),n.insertNode(i).setStartBefore(i).collapse(!0),n.select(),domUtils.remove(i)):n.select())}})},UM.plugins.autosave=function(){var n=this,i=new Date,o=20,r=null;n.setOpt("saveInterval",500);var a,s,l,d=UM.LocalStorage=(s=window.localStorage||((a=document.createElement("div")).style.display="none",a.addBehavior?(a.addBehavior("#default#userdata"),{getItem:function(e){var t=null;try{document.body.appendChild(a),a.load(l),t=a.getAttribute(e),document.body.removeChild(a)}catch(e){}return t},setItem:function(e,t){document.body.appendChild(a),a.setAttribute(e,t),a.save(l),document.body.removeChild(a)},removeItem:function(e){document.body.appendChild(a),a.removeAttribute(e),a.save(l),document.body.removeChild(a)}}):null)||null,l="localStorage",{saveLocalData:function(e,t){return!(!s||!t)&&(s.setItem(e,t),!0)},getLocalData:function(e){return s?s.getItem(e):null},removeItem:function(e){s&&s.removeItem(e)}});function e(e){var t;new Date-i<o||(e.hasContents()?(i=new Date,e._saveFlag=null,t=n.body.innerHTML,!1!==e.fireEvent("beforeautosave",{content:t})&&(d.saveLocalData(r,t),e.fireEvent("afterautosave",{content:t}))):r&&d.removeItem(r))}n.addListener("ready",function(){var e="-drafts-data",t=null,t=n.key?n.key+e:(n.container.parentNode.id||"ue-common")+e;r=(location.protocol+location.host+location.pathname).replace(/[.:\/]/g,"_")+t}),n.addListener("contentchange",function(){r&&(n._saveFlag&&window.clearTimeout(n._saveFlag),0<n.options.saveInterval?n._saveFlag=window.setTimeout(function(){e(n)},n.options.saveInterval):e(n))}),n.commands.clearlocaldata={execCommand:function(e,t){r&&d.getLocalData(r)&&d.removeItem(r)},notNeedUndo:!0,ignoreContentChange:!0},n.commands.getlocaldata={execCommand:function(e,t){return r&&d.getLocalData(r)||""},notNeedUndo:!0,ignoreContentChange:!0},n.commands.drafts={execCommand:function(e,t){r&&(n.body.innerHTML=d.getLocalData(r)||"<p>"+(browser.ie?"&nbsp;":"<br/>")+"</p>",n.focus(!0))},queryCommandState:function(){return!r||null===d.getLocalData(r)?-1:0},notNeedUndo:!0,ignoreContentChange:!0}},UM.plugins.autoupload=function(){var me=this;me.setOpt("pasteImageEnabled",!0),me.setOpt("dropFileEnabled",!0);var sendAndInsertImage=function(file,editor){var fd=new FormData;fd.append(editor.options.imageFieldName||"upfile",file,file.name||"blob."+file.type.substr("image/".length)),fd.append("type","ajax");var xhr=new XMLHttpRequest;xhr.open("post",me.options.imageUrl,!0),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.addEventListener("load",function(e){try{var json=eval("("+e.target.response+")"),link=json.url,picLink=me.options.imagePath+link;editor.execCommand("insertimage",{src:picLink,_src:picLink})}catch(e){}}),xhr.send(fd)};function getPasteImage(e){return e.clipboardData&&e.clipboardData.items&&1==e.clipboardData.items.length&&/^image\//.test(e.clipboardData.items[0].type)?e.clipboardData.items:null}function getDropImage(e){return e.dataTransfer&&e.dataTransfer.files?e.dataTransfer.files:null}me.addListener("ready",function(){var e;window.FormData&&window.FileReader&&(e=function(e){var t=!1,n=("paste"==e.type?getPasteImage:getDropImage)(e.originalEvent);if(n){for(var i,o=n.length;o--;)(i=n[o]).getAsFile&&(i=i.getAsFile()),i&&0<i.size&&/image\/\w+/i.test(i.type)&&(sendAndInsertImage(i,me),t=!0);if(t)return!1}},me.getOpt("pasteImageEnabled")&&me.$body.on("paste",e),me.getOpt("dropFileEnabled")&&me.$body.on("drop",e),me.$body.on("dragover",function(e){if("Files"==e.originalEvent.dataTransfer.types[0])return!1}))})},UM.plugins.formula=function(){var o=this;function i(){return o.$body.find("iframe.edui-formula-active")[0]||null}function n(){var e=i();e&&e.contentWindow.formula.blur()}o.addInputRule(function(e){$.each(e.getNodesByTagName("span"),function(e,t){if(t.hasClass("mathquill-embedded-latex")){for(var n,i="";n=t.firstChild();)i+=n.data,t.removeChild(n);t.tagName="iframe",t.setAttr({frameborder:"0",src:o.getOpt("UMEDITOR_HOME_URL")+"dialogs/formula/formula.html","data-latex":utils.unhtml(i)})}})}),o.addOutputRule(function(e){$.each(e.getNodesByTagName("iframe"),function(e,t){t.hasClass("mathquill-embedded-latex")&&(t.tagName="span",t.appendChild(UM.uNode.createText(t.getAttr("data-latex"))),t.setAttr({frameborder:"",src:"","data-latex":""}))})}),o.addListener("click",function(){n()}),o.addListener("afterexeccommand",function(e,t){"formula"!=t&&n()}),o.commands.formula={execCommand:function(e,t){var n=i();n?n.contentWindow.formula.insertLatex(t):(o.execCommand("inserthtml",'<span class="mathquill-embedded-latex">'+t+"</span>"),browser.ie&&browser.ie9below&&setTimeout(function(){var e=o.selection.getRange(),t=e.startContainer;1!=t.nodeType||t.childNodes[e.startOffset]||(e.insertNode(o.document.createTextNode(" ")),e.setCursor())},100))},queryCommandState:function(e){return 0},queryCommandValue:function(e){var t=i();return t&&t.contentWindow.formula.getLatex()}}},function(u){u.parseTmpl=function(e,t){var n="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+e.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/<%=([\s\S]+?)%>/g,function(e,t){return"',"+t.replace(/\\'/g,"'")+",'"}).replace(/<%([\s\S]+?)%>/g,function(e,t){return"');"+t.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",i=new Function("obj",n);return t?i(t):i},u.extend2=function(e,t){for(var n=arguments,i="boolean"==u.type(n[n.length-1])&&n[n.length-1],o="boolean"==u.type(n[n.length-1])?n.length-1:n.length,r=1;r<o;r++){var a,s=n[r];for(a in s)i&&e.hasOwnProperty(a)||(e[a]=s[a])}return e},u.IE6=!!window.ActiveXObject&&6==parseFloat(navigator.userAgent.match(/msie (\d+)/i)[1]);function h(){}var o=[],f="edui";h.prototype={on:function(e,t){return this.root().on(e,u.proxy(t,this)),this},off:function(e,t){return this.root().off(e,u.proxy(t,this)),this},trigger:function(e,t){return!1!==this.root().trigger(e,t)&&this},root:function(e){return this._$el||(this._$el=e)},destroy:function(){},data:function(e,t){return void 0!==t?(this.root().data(f+e,t),this):this.root().data(f+e)},register:function(e,t,n){o.push({evtname:e,$els:u.isArray(t)?t:[t],handler:u.proxy(n,t)})}},u.fn.edui=function(e){return e?this.data("eduiwidget",e):this.data("eduiwidget")};var m=1;UM.ui={define:function(o,e,t){var n,i,r,a,s,l,d,c=UM.ui[o]=(i=e,r=t,(n=function(e,t){function n(){}u.extend(n.prototype,c.prototype,{guid:o+m++,widgetName:o});var i=new n;if("string"==u.type(e))return i.init&&i.init({}),i.root().edui(i),i.root().find("a").click(function(e){e.preventDefault()}),i.root()[f+o].apply(i.root(),arguments);t&&i.root(t),i.init&&i.init(!e||u.isPlainObject(e)?u.extend2(e||{},i.defaultOpt||{},!0):e);try{i.root().find("a").click(function(e){e.preventDefault()})}catch(e){}return i.root().edui(i)}).prototype=u.extend2(u.extend({},i),(UM.ui[r]||h).prototype,!0),n.prototype.supper=(UM.ui[r]||h).prototype,UM.ui[r]&&UM.ui[r].prototype.defaultOpt&&(a=UM.ui[r].prototype.defaultOpt,s=n.prototype.defaultOpt,n.prototype.defaultOpt=u.extend({},a,s||{})),n);l=c,u[f+(d=o)]=l,u.fn[f+d]=function(o){var r,a=Array.prototype.slice.call(arguments,1);return this.each(function(e,t){var n=u(t),i=n.edui();if(i||(l(o&&u.isPlainObject(o)?o:{},n),n.edui(i)),"string"==u.type(o))if("this"==o)r=i;else{if((r=i[o].apply(i,a))!==i&&void 0!==r)return!1;r=null}}),null!==r?r:this}}},u(function(){u(document).on("click mouseup mousedown dblclick mouseover",function(i){u.each(o,function(e,n){n.evtname==i.type&&u.each(n.$els,function(e,t){t[0]===i.target||u.contains(t[0],i.target)||n.handler(i)})})})})}(jQuery),UM.ui.define("button",{tpl:'<<%if(!texttype){%>div class="edui-btn edui-btn-<%=icon%> <%if(name){%>edui-btn-name-<%=name%><%}%>" unselectable="on" onmousedown="return false" <%}else{%>a class="edui-text-btn"<%}%><% if(title) {%> data-original-title="<%=title%>" <%};%>> <% if(icon) {%><div unselectable="on" class="edui-icon-<%=icon%> edui-icon"></div><% }; %><%if(text) {%><span unselectable="on" onmousedown="return false" class="edui-button-label"><%=text%></span><%}%><%if(caret && text){%><span class="edui-button-spacing"></span><%}%><% if(caret) {%><span unselectable="on" onmousedown="return false" class="edui-caret"></span><% };%></<%if(!texttype){%>div<%}else{%>a<%}%>>',defaultOpt:{text:"",title:"",icon:"",width:"",caret:!1,texttype:!1,click:function(){}},init:function(t){var n=this;return n.root($($.parseTmpl(n.tpl,t))).click(function(e){n.wrapclick(t.click,e)}),n.root().hover(function(){n.root().hasClass("edui-disabled")||n.root().toggleClass("edui-hover")}),n},wrapclick:function(e,t){return this.disabled()||(this.root().trigger("wrapclick"),$.proxy(e,this,t)()),this},label:function(e){return void 0===e?this.root().find(".edui-button-label").text():(this.root().find(".edui-button-label").text(e),this)},disabled:function(e){return void 0===e?this.root().hasClass("edui-disabled"):(this.root().toggleClass("edui-disabled",e),this.root().hasClass("edui-disabled")&&this.root().removeClass("edui-hover"),this)},active:function(e){return void 0===e?this.root().hasClass("edui-active"):(this.root().toggleClass("edui-active",e),this)},mergeWith:function(t){var e=this;e.data("$mergeObj",t),t.edui().data("$mergeObj",e.root()),$.contains(document.body,t[0])||t.appendTo(e.root()),e.on("click",function(){e.wrapclick(function(){t.edui().show()})}).register("click",e.root(),function(e){t.hide()})}}),UM.ui.define("toolbar",{tpl:'<div class="edui-toolbar"  ><div class="edui-btn-toolbar" unselectable="on" onmousedown="return false"  ></div></div>',init:function(){var e=this.root($(this.tpl));this.data("$btnToolbar",e.find(".edui-btn-toolbar"))},appendToBtnmenu:function(e){var n=this.data("$btnToolbar");e=$.isArray(e)?e:[e],$.each(e,function(e,t){n.append(t)})}}),UM.ui.define("menu",{show:function(e,t,n,i,o){n=n||"position",!1!==this.trigger("beforeshow")&&(this.root().css($.extend({display:"block"},e?{top:e[n]().top+("right"==t?0:e.outerHeight())-(i||0),left:e[n]().left+("right"==t?e.outerWidth():0)-(o||0)}:{})),this.trigger("aftershow"))},hide:function(e){var t;!1!==this.trigger("beforehide")&&((t=this.root().data("parentmenu"))&&(t.data("parentmenu")||e)&&t.edui().hide(),this.root().css("display","none"),this.trigger("afterhide"))},attachTo:function(e){var t=this;e.data("$mergeObj")||(e.data("$mergeObj",t.root()),e.on("wrapclick",function(e){t.show()}),t.register("click",e,function(e){t.hide()}),t.data("$mergeObj",e))}}),UM.ui.define("dropmenu",{tmpl:'<ul class="edui-dropdown-menu" aria-labelledby="dropdownMenu" ><%for(var i=0,ci;ci=data[i++];){%><%if(ci.divider){%><li class="edui-divider"></li><%}else{%><li <%if(ci.active||ci.disabled){%>class="<%= ci.active|| \'\' %> <%=ci.disabled||\'\' %>" <%}%> data-value="<%= ci.value%>"><a href="#" tabindex="-1"><em class="edui-dropmenu-checkbox"><i class="edui-icon-ok"></i></em><%= ci.label%></a></li><%}%><%}%></ul>',defaultOpt:{data:[],click:function(){}},init:function(t){var r=this,a={click:1,mouseover:1,mouseout:1};this.root($($.parseTmpl(this.tmpl,t))).on("click",'li[class!="edui-disabled edui-divider edui-dropdown-submenu"]',function(e){$.proxy(t.click,r,e,$(this).data("value"),$(this))()}).find("li").each(function(e,n){var i,o=$(this);o.hasClass("edui-disabled edui-divider edui-dropdown-submenu")||(i=t.data[e],$.each(a,function(t){i[t]&&o[t](function(e){$.proxy(i[t],n)(e,i,r.root)})}))})},disabled:function(t){$("li[class!=edui-divider]",this.root()).each(function(){var e=$(this);!0===t?e.addClass("edui-disabled"):$.isFunction(t)?e.toggleClass("edui-disabled",t(li)):e.removeClass("edui-disabled")})},val:function(t){var n;if($('li[class!="edui-divider edui-disabled edui-dropdown-submenu"]',this.root()).each(function(){var e=$(this);if(void 0===t){if(e.find("em.edui-dropmenu-checked").length)return n=e.data("value"),!1}else e.find("em").toggleClass("edui-dropmenu-checked",e.data("value")==t)}),void 0===t)return n},addSubmenu:function(e,t,n){n=n||0;var i=$("li[class!=edui-divider]",this.root()),o=$('<li class="edui-dropdown-submenu"><a tabindex="-1" href="#">'+e+"</a></li>").append(t);0<=n&&n<i.length?o.insertBefore(i[n]):n<0?o.insertBefore(i[0]):n>=i.length&&o.appendTo(i)}},"menu"),UM.ui.define("splitbutton",{tpl:'<div class="edui-splitbutton <%if (name){%>edui-splitbutton-<%= name %><%}%>"  unselectable="on" <%if(title){%>data-original-title="<%=title%>"<%}%>><div class="edui-btn"  unselectable="on" ><%if(icon){%><div  unselectable="on" class="edui-icon-<%=icon%> edui-icon"></div><%}%><%if(text){%><%=text%><%}%></div><div  unselectable="on" class="edui-btn edui-dropdown-toggle" ><div  unselectable="on" class="edui-caret"></div></div></div>',defaultOpt:{text:"",title:"",click:function(){}},init:function(t){var n=this;return n.root($($.parseTmpl(n.tpl,t))),n.root().find(".edui-btn:first").click(function(e){n.disabled()||$.proxy(t.click,n)()}),n.root().find(".edui-dropdown-toggle").click(function(){n.disabled()||n.trigger("arrowclick")}),n.root().hover(function(){n.root().hasClass("edui-disabled")||n.root().toggleClass("edui-hover")}),n},wrapclick:function(e,t){return this.disabled()||$.proxy(e,this,t)(),this},disabled:function(e){return void 0===e?this.root().hasClass("edui-disabled"):(this.root().toggleClass("edui-disabled",e).find(".edui-btn").toggleClass("edui-disabled",e),this)},active:function(e){return void 0===e?this.root().hasClass("edui-active"):(this.root().toggleClass("edui-active",e).find(".edui-btn:first").toggleClass("edui-active",e),this)},mergeWith:function(t){var e=this;e.data("$mergeObj",t),t.edui().data("$mergeObj",e.root()),$.contains(document.body,t[0])||t.appendTo(e.root()),e.root().delegate(".edui-dropdown-toggle","click",function(){e.wrapclick(function(){t.edui().show()})}),e.register("click",e.root().find(".edui-dropdown-toggle"),function(e){t.hide()})}}),UM.ui.define("colorsplitbutton",{tpl:'<div class="edui-splitbutton <%if (name){%>edui-splitbutton-<%= name %><%}%>"  unselectable="on" <%if(title){%>data-original-title="<%=title%>"<%}%>><div class="edui-btn"  unselectable="on" ><%if(icon){%><div  unselectable="on" class="edui-icon-<%=icon%> edui-icon"></div><%}%><div class="edui-splitbutton-color-label" <%if (color) {%>style="background: <%=color%>"<%}%>></div><%if(text){%><%=text%><%}%></div><div  unselectable="on" class="edui-btn edui-dropdown-toggle" ><div  unselectable="on" class="edui-caret"></div></div></div>',defaultOpt:{color:""},init:function(e){this.supper.init.call(this,e)},colorLabel:function(){return this.root().find(".edui-splitbutton-color-label")}},"splitbutton"),UM.ui.define("popup",{tpl:'<div class="edui-dropdown-menu edui-popup"<%if(!<%=stopprop%>){%>onmousedown="return false"<%}%>><div class="edui-popup-body" unselectable="on" onmousedown="return false"><%=subtpl%></div><div class="edui-popup-caret"></div></div>',defaultOpt:{stopprop:!1,subtpl:"",width:"",height:""},init:function(e){return this.root($($.parseTmpl(this.tpl,e))),this},mergeTpl:function(e){return $.parseTmpl(this.tpl,{subtpl:e})},show:function(e,t){var n=(t=t||{}).fnname||"position";!1!==this.trigger("beforeshow")&&(this.root().css($.extend({display:"block"},e?{top:e[n]().top+("right"==t.dir?0:e.outerHeight())-(t.offsetTop||0),left:e[n]().left+("right"==t.dir?e.outerWidth():0)-(t.offsetLeft||0),position:"absolute"}:{})),this.root().find(".edui-popup-caret").css({top:t.caretTop||0,left:t.caretLeft||0,position:"absolute"}).addClass(t.caretDir||"up"),this.trigger("aftershow"))},hide:function(){this.root().css("display","none"),this.trigger("afterhide")},attachTo:function(t,n){var i=this;t.data("$mergeObj")||(t.data("$mergeObj",i.root()),t.on("wrapclick",function(e){i.show(t,n)}),i.register("click",t,function(e){i.hide()}),i.data("$mergeObj",t))},getBodyContainer:function(){return this.root().find(".edui-popup-body")}}),UM.ui.define("scale",{tpl:'<div class="edui-scale" unselectable="on"><span class="edui-scale-hand0"></span><span class="edui-scale-hand1"></span><span class="edui-scale-hand2"></span><span class="edui-scale-hand3"></span><span class="edui-scale-hand4"></span><span class="edui-scale-hand5"></span><span class="edui-scale-hand6"></span><span class="edui-scale-hand7"></span></div>',defaultOpt:{$doc:$(document),$wrap:$(document)},init:function(e){return e.$doc&&(this.defaultOpt.$doc=e.$doc),e.$wrap&&(this.defaultOpt.$wrap=e.$wrap),this.root($($.parseTmpl(this.tpl,e))),this.initStyle(),this.startPos=this.prePos={x:0,y:0},this.dragId=-1,this},initStyle:function(){utils.cssRule("edui-style-scale",".edui-scale{display:none;position:absolute;border:1px solid #38B2CE;cursor:hand;}.edui-scale span{position:absolute;left:0;top:0;width:7px;height:7px;overflow:hidden;font-size:0px;display:block;background-color:#3C9DD0;}.edui-scale .edui-scale-hand0{cursor:nw-resize;top:0;margin-top:-4px;left:0;margin-left:-4px;}.edui-scale .edui-scale-hand1{cursor:n-resize;top:0;margin-top:-4px;left:50%;margin-left:-4px;}.edui-scale .edui-scale-hand2{cursor:ne-resize;top:0;margin-top:-4px;left:100%;margin-left:-3px;}.edui-scale .edui-scale-hand3{cursor:w-resize;top:50%;margin-top:-4px;left:0;margin-left:-4px;}.edui-scale .edui-scale-hand4{cursor:e-resize;top:50%;margin-top:-4px;left:100%;margin-left:-3px;}.edui-scale .edui-scale-hand5{cursor:sw-resize;top:100%;margin-top:-3px;left:0;margin-left:-4px;}.edui-scale .edui-scale-hand6{cursor:s-resize;top:100%;margin-top:-3px;left:50%;margin-left:-4px;}.edui-scale .edui-scale-hand7{cursor:se-resize;top:100%;margin-top:-3px;left:100%;margin-left:-3px;}")},_eventHandler:function(e){var t=this,n=t.defaultOpt.$doc;switch(e.type){case"mousedown":var i=e.target||e.srcElement;-1!=i.className.indexOf("edui-scale-hand")&&(t.dragId=i.className.slice(-1),t.startPos.x=t.prePos.x=e.clientX,t.startPos.y=t.prePos.y=e.clientY,n.bind("mousemove",$.proxy(t._eventHandler,t)));break;case"mousemove":-1!=t.dragId&&(t.updateContainerStyle(t.dragId,{x:e.clientX-t.prePos.x,y:e.clientY-t.prePos.y}),t.prePos.x=e.clientX,t.prePos.y=e.clientY,t.updateTargetElement());break;case"mouseup":-1!=t.dragId&&(t.dragId=-1,t.updateTargetElement(),t.data("$scaleTarget").parent()&&t.attachTo(t.data("$scaleTarget"))),n.unbind("mousemove",$.proxy(t._eventHandler,t))}},updateTargetElement:function(){var e=this.root(),t=this.data("$scaleTarget");t.css({width:e.width(),height:e.height()}),this.attachTo(t)},updateContainerStyle:function(e,t){var n,i=this,o=i.root(),r=[[0,0,-1,-1],[0,0,0,-1],[0,0,1,-1],[0,0,-1,0],[0,0,1,0],[0,0,-1,1],[0,0,0,1],[0,0,1,1]];0!=r[e][0]&&(n=parseInt(o.offset().left)+t.x,o.css("left",i._validScaledProp("left",n))),0!=r[e][1]&&(n=parseInt(o.offset().top)+t.y,o.css("top",i._validScaledProp("top",n))),0!=r[e][2]&&(n=o.width()+r[e][2]*t.x,o.css("width",i._validScaledProp("width",n))),0!=r[e][3]&&(n=o.height()+r[e][3]*t.y,o.css("height",i._validScaledProp("height",n)))},_validScaledProp:function(e,i){function t(e,t,n){return n<e+t?n-t:i}var n=this.root(),o=this.defaultOpt.$doc;switch(i=isNaN(i)?0:i,e){case"left":return i<0?0:t(i,n.width(),o.width());case"top":return i<0?0:t(i,n.height(),o.height());case"width":return i<=0?1:t(i,n.offset().left,o.width());case"height":return i<=0?1:t(i,n.offset().top,o.height())}},show:function(e){var t=this;e&&t.attachTo(e),t.root().bind("mousedown",$.proxy(t._eventHandler,t)),t.defaultOpt.$doc.bind("mouseup",$.proxy(t._eventHandler,t)),t.root().show(),t.trigger("aftershow")},hide:function(){var e=this;e.root().unbind("mousedown",$.proxy(e._eventHandler,e)),e.defaultOpt.$doc.unbind("mouseup",$.proxy(e._eventHandler,e)),e.root().hide(),e.trigger("afterhide")},attachTo:function(e){var t=e.offset(),n=this.root(),i=this.defaultOpt.$wrap,o=i.offset();this.data("$scaleTarget",e),this.root().css({position:"absolute",width:e.width(),height:e.height(),left:t.left-o.left-parseInt(i.css("border-left-width"))-parseInt(n.css("border-left-width")),top:t.top-o.top-parseInt(i.css("border-top-width"))-parseInt(n.css("border-top-width"))})},getScaleTarget:function(){return this.data("$scaleTarget")[0]}}),UM.ui.define("colorpicker",{tpl:function(e){for(var t="ffffff,000000,eeece1,1f497d,4f81bd,c0504d,9bbb59,8064a2,4bacc6,f79646,f2f2f2,7f7f7f,ddd9c3,c6d9f0,dbe5f1,f2dcdb,ebf1dd,e5e0ec,dbeef3,fdeada,d8d8d8,595959,c4bd97,8db3e2,b8cce4,e5b9b7,d7e3bc,ccc1d9,b7dde8,fbd5b5,bfbfbf,3f3f3f,938953,548dd4,95b3d7,d99694,c3d69b,b2a2c7,92cddc,fac08f,a5a5a5,262626,494429,17365d,366092,953734,76923c,5f497a,31859b,e36c09,7f7f7f,0c0c0c,1d1b10,0f243e,244061,632423,4f6128,3f3151,205867,974806,c00000,ff0000,ffc000,ffff00,92d050,00b050,00b0f0,0070c0,002060,7030a0,".split(","),n='<div unselectable="on" onmousedown="return false" class="edui-colorpicker<%if (name){%> edui-colorpicker-<%=name%><%}%>" ><table unselectable="on" onmousedown="return false"><tr><td colspan="10">'+e.lang_themeColor+'</td> </tr><tr class="edui-colorpicker-firstrow" >',i=0;i<t.length;i++)i&&i%10==0&&(n+="</tr>"+(60==i?'<tr><td colspan="10">'+e.lang_standardColor+"</td></tr>":"")+"<tr"+(60==i?' class="edui-colorpicker-firstrow"':"")+">"),n+=i<70?'<td><a unselectable="on" onmousedown="return false" title="'+t[i]+'" class="edui-colorpicker-colorcell" data-color="#'+t[i]+'" style="background-color:#'+t[i]+";border:solid #ccc;"+(i<10||60<=i?"border-width:1px;":10<=i&&i<20?"border-width:1px 1px 0 1px;":"border-width:0 1px 0 1px;")+'"></a></td>':"";return n+="</tr></table></div>"},init:function(e){var t=this;t.root($($.parseTmpl(t.supper.mergeTpl(t.tpl(e)),e))),t.root().on("click",function(e){t.trigger("pickcolor",$(e.target).data("color"))})}},"popup"),yB="edui-combobox-item",BB="edui-combobox-item-label",UM.ui.define("combobox",{tpl:'<ul class="dropdown-menu edui-combobox-menu<%if (comboboxName!==\'\') {%> edui-combobox-<%=comboboxName%><%}%>" unselectable="on" onmousedown="return false" role="menu" aria-labelledby="dropdownMenu"><%if(autoRecord) {%><%for( var i=0, len = recordStack.length; i<len; i++ ) {%><%var index = recordStack[i];%><li class="<%=itemClassName%><%if( selected == index ) {%> edui-combobox-checked<%}%>" data-item-index="<%=index%>" unselectable="on" onmousedown="return false"><span class="edui-combobox-icon" unselectable="on" onmousedown="return false"></span><label class="<%=labelClassName%>" style="<%=itemStyles[ index ]%>" unselectable="on" onmousedown="return false"><%=items[index]%></label></li><%}%><%if( i ) {%><li class="edui-combobox-item-separator"></li><%}%><%}%><%for( var i=0, label; label = items[i]; i++ ) {%><li class="<%=itemClassName%><%if( selected == i ) {%> edui-combobox-checked<%}%> edui-combobox-item-<%=i%>" data-item-index="<%=i%>" unselectable="on" onmousedown="return false"><span class="edui-combobox-icon" unselectable="on" onmousedown="return false"></span><label class="<%=labelClassName%>" style="<%=itemStyles[ i ]%>" unselectable="on" onmousedown="return false"><%=label%></label></li><%}%></ul>',defaultOpt:{recordStack:[],items:[],value:[],comboboxName:"",selected:"",autoRecord:!0,recordCount:5},init:function(e){$.extend(this._optionAdaptation(e),this._createItemMapping(e.recordStack,e.items),{itemClassName:yB,iconClass:"edui-combobox-checked-icon",labelClassName:BB}),this._transStack(e),this.root($($.parseTmpl(this.tpl,e))),this.data("options",e).initEvent()},initEvent:function(){this.initSelectItem(),this.initItemActive()},initSelectItem:function(){var n=this;n.root().delegate("."+yB,"click",function(){var e=$(this),t=e.attr("data-item-index");return n.trigger("comboboxselect",{index:t,label:e.find(".edui-combobox-item-label").text(),value:n.data("options").value[t]}).select(t),n.hide(),!1})},initItemActive:function(){var t={mouseenter:"addClass",mouseleave:"removeClass"};$.IE6&&this.root().delegate("."+yB,"mouseenter mouseleave",function(e){$(this)[t[e.type]]("edui-combobox-item-hover")}).one("afterhide",function(){})},select:function(e){var t=this.data("options").itemCount,n=this.data("options").autowidthitem;return n&&!n.length&&(n=this.data("options").items),0==t||(e<0?e=t+e%t:t<=e&&(e=t-1),this.trigger("changebefore",n[e]),this._update(e),this.trigger("changeafter",n[e])),null},selectItemByLabel:function(e){var n,i=this.data("options").itemMapping,o=this;$.isArray(e)||(e=[e]),$.each(e,function(e,t){if(void 0!==(n=i[t]))return o.select(n),!1})},_transStack:function(n){var i,o=[],r=-1;$.each(n.recordStack,function(e,t){i=n.itemMapping[t],$.isNumeric(i)&&(o.push(i),t==n.selected&&(r=i))}),n.recordStack=o,n.selected=r,o=null},_optionAdaptation:function(e){if(!("itemStyles"in e)){e.itemStyles=[];for(var t=0,n=e.items.length;t<n;t++)e.itemStyles.push("")}return e.autowidthitem=e.autowidthitem||e.items,e.itemCount=e.items.length,e},_createItemMapping:function(e,t){var n={},i={recordStack:[],mapping:{}};return $.each(t,function(e,t){n[t]=e}),i.itemMapping=n,$.each(e,function(e,t){void 0!==n[t]&&(i.recordStack.push(n[t]),i.mapping[t]=n[t])}),i},_update:function(n){var e=this.data("options"),i=[],t=null;$.each(e.recordStack,function(e,t){t!=n&&i.push(t)}),i.unshift(n),i.length>e.recordCount&&(i.length=e.recordCount),e.recordStack=i,e.selected=n,t=$($.parseTmpl(this.tpl,e)),this.root().html(t.html()),i=t=null}},"menu"),UM.ui.define("buttoncombobox",{defaultOpt:{label:"",title:""},init:function(e){var t=this,n=$.eduibutton({caret:!0,name:e.comboboxName,title:e.title,text:e.label,click:function(){t.show(this.root())}});t.supper.init.call(t,e),t.on("changebefore",function(e,t){n.eduibutton("label",t)}),t.data("button",n),t.attachTo(n)},button:function(){return this.data("button")}},"combobox"),UM.ui.define("modal",{tpl:'<div class="edui-modal" tabindex="-1" ><div class="edui-modal-header"><div class="edui-close" data-hide="modal"></div><h3 class="edui-title"><%=title%></h3></div><div class="edui-modal-body"  style="<%if(width){%>width:<%=width%>px;<%}%><%if(height){%>height:<%=height%>px;<%}%>"> </div><% if(cancellabel || oklabel) {%><div class="edui-modal-footer"><div class="edui-modal-tip"></div><%if(oklabel){%><div class="edui-btn edui-btn-primary" data-ok="modal"><%=oklabel%></div><%}%><%if(cancellabel){%><div class="edui-btn" data-hide="modal"><%=cancellabel%></div><%}%></div><%}%></div>',defaultOpt:{title:"",cancellabel:"",oklabel:"",width:"",height:"",backdrop:!0,keyboard:!0},init:function(e){var t=this;t.root($($.parseTmpl(t.tpl,e||{}))),t.data("options",e),e.okFn&&t.on("ok",$.proxy(e.okFn,t)),e.cancelFn&&t.on("beforehide",$.proxy(e.cancelFn,t)),t.root().delegate('[data-hide="modal"]',"click",$.proxy(t.hide,t)).delegate('[data-ok="modal"]',"click",$.proxy(t.ok,t)),$('[data-hide="modal"],[data-ok="modal"]',t.root()).hover(function(){$(this).toggleClass("edui-hover")})},toggle:function(){return this[this.data("isShown")?"hide":"show"]()},show:function(){var e=this;e.trigger("beforeshow"),e.data("isShown")||(e.data("isShown",!0),e.escape(),e.backdrop(function(){e.autoCenter(),e.root().show().focus().trigger("aftershow")}))},showTip:function(e){$(".edui-modal-tip",this.root()).html(e).fadeIn()},hideTip:function(e){$(".edui-modal-tip",this.root()).fadeOut(function(){$(this).html("")})},autoCenter:function(){$.IE6||this.root().css("margin-left",-this.root().width()/2)},hide:function(){var e=this;e.trigger("beforehide"),e.data("isShown")&&(e.data("isShown",!1),e.escape(),e.hideModal())},escape:function(){var t=this;t.data("isShown")&&t.data("options").keyboard?t.root().on("keyup",function(e){27==e.which&&t.hide()}):t.data("isShown")||t.root().off("keyup")},hideModal:function(){var e=this;e.root().hide(),e.backdrop(function(){e.removeBackdrop(),e.trigger("afterhide")})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},backdrop:function(e){var t=this;t.data("isShown")&&t.data("options").backdrop&&(t.$backdrop=$('<div class="edui-modal-backdrop" />').click("static"==t.data("options").backdrop?$.proxy(t.root()[0].focus,t.root()[0]):$.proxy(t.hide,t))),t.trigger("afterbackdrop"),e&&e()},attachTo:function(e){var t=this;e.data("$mergeObj")||(e.data("$mergeObj",t.root()),e.on("click",function(){t.toggle(e)}),t.data("$mergeObj",e))},ok:function(){this.trigger("beforeok"),!1!==this.trigger("ok",this)&&this.hide()},getBodyContainer:function(){return this.root().find(".edui-modal-body")}}),UM.ui.define("tooltip",{tpl:'<div class="edui-tooltip" unselectable="on" onmousedown="return false"><div class="edui-tooltip-arrow" unselectable="on" onmousedown="return false"></div><div class="edui-tooltip-inner" unselectable="on" onmousedown="return false"></div></div>',init:function(e){this.root($($.parseTmpl(this.tpl,e||{})))},content:function(e){var t=$(e.currentTarget).attr("data-original-title");this.root().find(".edui-tooltip-inner").text(t)},position:function(e){var t=$(e.currentTarget);this.root().css($.extend({display:"block"},t?{top:t.outerHeight(),left:(t.outerWidth()-this.root().outerWidth())/2}:{}))},show:function(e){$(e.currentTarget).hasClass("edui-disabled")||(this.content(e),this.root().appendTo($(e.currentTarget)),this.position(e),this.root().css("display","block"))},hide:function(){this.root().css("display","none")},attachTo:function(e){var n=this;function i(e){var t=this;$.contains(document.body,t.root()[0])||t.root().appendTo(e),t.data("tooltip",t.root()),e.each(function(){$(this).attr("data-original-title")&&$(this).on("mouseenter",$.proxy(t.show,t)).on("mouseleave click",$.proxy(t.hide,t))})}"undefined"===$.type(e)?$("[data-original-title]").each(function(e,t){i.call(n,$(t))}):e.data("tooltip")||i.call(n,e)}}),UM.ui.define("tab",{init:function(e){var t=this,n=e.selector;$.type(n)&&(t.root($(n,e.context)),t.data("context",e.context),$(n,t.data("context")).on("click",function(e){t.show(e)}))},show:function(e){var t,n,i=this,o=$(e.target),r=o.closest("ul"),a=o.attr("data-context");a=a&&a.replace(/.*(?=#[^\s]*$)/,"");var s=o.parent("li");s.length&&!s.hasClass("edui-active")&&(t=r.find(".edui-active:last a")[0],e=$.Event("beforeshow",{target:o[0],relatedTarget:t}),i.trigger(e),e.isDefaultPrevented()||(n=$(a,i.data("context")),i.activate(o.parent("li"),r),i.activate(n,n.parent(),function(){i.trigger({type:"aftershow",relatedTarget:t})})))},activate:function(e,t,n){if(void 0===e)return $(".edui-tab-item.edui-active",this.root()).index();t.find("> .edui-active").removeClass("edui-active"),e.addClass("edui-active"),n&&n()}}),UM.ui.define("separator",{tpl:'<div class="edui-separator" unselectable="on" onmousedown="return false" ></div>',init:function(e){return this.root($($.parseTmpl(this.tpl,e))),this}}),sD={},tD={},uD=[],wD={},xD={},yD={},zD=null,utils.extend(UM,{defaultWidth:500,defaultHeight:500,registerUI:function(e,t){utils.each(e.split(/\s+/),function(e){sD[e]=t})},setEditor:function(e){tD[e.id]||(tD[e.id]=e)},registerWidget:function(e,t,n){wD[e]=$.extend2(t,{$root:"",_preventDefault:!1,root:function(e){return this.$root||(this.$root=e)},preventDefault:function(){this._preventDefault=!0},clear:!1}),n&&(xD[e]=n)},getWidgetData:function(e){return wD[e]},setWidgetBody:function(e,n,t){t._widgetData||utils.extend(t,{_widgetData:{},getWidgetData:function(e){return this._widgetData[e]},getWidgetCallback:function(e){var t=this;return function(){return xD[e].apply(t,[t,n].concat(Array.prototype.slice.call(arguments,0)))}}});var i=wD[e];if(!i)return null;(i=t._widgetData[e])||(i=wD[e],i=t._widgetData[e]="function"==$.type(i)?i:utils.clone(i)),i.root(n.edui().getBodyContainer()),i.initContent(t,n),i._preventDefault||i.initEvent(t,n),i.width&&n.width(i.width)},setActiveWidget:function(e){0},getEditor:function(e,t){var n=tD[e]||(tD[e]=this.createEditor(e,t));return zD=zD?Math.max(n.getOpt("zIndex"),zD):n.getOpt("zIndex"),n},setTopEditor:function(n){$.each(tD,function(e,t){n==t?n.$container&&n.$container.css("zIndex",zD+1):t.$container&&t.$container.css("zIndex",t.getOpt("zIndex"))})},clearCache:function(e){tD[e]&&delete tD[e]},delEditor:function(e){var t;(t=tD[e])&&t.destroy()},ready:function(e){uD.push(e)},createEditor:function(n,e){var i=new UM.Editor(e);function t(){var e=this.createUI("#"+n,i);i.key=n,i.ready(function(){$.each(uD,function(e,t){$.proxy(t,i)()})});var t=i.options;t.initialFrameWidth?t.minFrameWidth=t.initialFrameWidth:t.minFrameWidth=t.initialFrameWidth=i.$body.width()||UM.defaultWidth,e.css({width:t.initialFrameWidth,zIndex:i.getOpt("zIndex")}),UM.browser.ie&&6===UM.browser.version&&document.execCommand("BackgroundImageCache",!1,!0),i.render(n),$.eduitooltip&&$.eduitooltip("attachTo",$("[data-original-title]",e)).css("z-index",i.getOpt("zIndex")+1),e.find("a").click(function(e){e.preventDefault()}),i.fireEvent("afteruiready")}return i.langIsReady?$.proxy(t,this)():i.addListener("langReady",$.proxy(t,this)),i},createUI:function(e,i){var t=$(e),n=$('<div class="edui-container"><div class="edui-editor-body"></div></div>').insertBefore(t);return i.$container=n,i.container=n[0],i.$body=t,browser.ie&&browser.ie9above&&$('<span style="padding:0;margin:0;height:0;width:0"></span>').insertAfter(n),$.each(sD,function(e,t){var n=t.call(i,e);n&&(yD[e]=n)}),n.find(".edui-editor-body").append(t).before(this.createToolbar(i.options,i)),n.find(".edui-toolbar").append($('<div class="edui-dialog-container"></div>')),n},createToolbar:function(e,t){var i,n=$.eduitoolbar(),o=n.edui();return e.toolbar&&e.toolbar.length?(i=[],$.each(e.toolbar,function(e,t){$.each(t.split(/\s+/),function(e,t){var n;"|"==t?$.eduiseparator&&i.push($.eduiseparator()):(n=yD[t],"fullscreen"==t?n&&i.unshift(n):n&&i.push(n))}),i.length&&o.appendToBtnmenu(i)})):n.find(".edui-btn-toolbar").remove(),n}}),UM.registerUI("bold italic redo undo underline strikethrough superscript subscript insertorderedlist insertunorderedlist cleardoc selectall link unlink print preview justifyleft justifycenter justifyright justifyfull removeformat horizontal drafts",function(t){var e=this,n=$.eduibutton({icon:t,click:function(){e.execCommand(t)},title:this.getLang("labelMap")[t]||""});return this.addListener("selectionchange",function(){var e=this.queryCommandState(t);n.edui().disabled(-1==e).active(1==e)}),n}),FE={},GE=["width","height","position","top","left","margin","padding","overflowX","overflowY"],HE={},IE={},JE={},KE={},UM.registerUI("fullscreen",function(t){var e=this,n=$.eduibutton({icon:"fullscreen",title:e.options.labelMap&&e.options.labelMap[t]||e.getLang("labelMap."+t),click:function(){e.execCommand(t),UM.setTopEditor(e)}});return e.addListener("selectionchange",function(){var e=this.queryCommandState(t);n.edui().disabled(-1==e).active(1==e)}),e.addListener("ready",function(){e.options.fullscreen&&LE.getInstance(e).toggle()}),n}),UM.commands.fullscreen={execCommand:function(e){LE.getInstance(this).toggle()},queryCommandState:function(e){return this._edui_fullscreen_status},notNeedUndo:1},LE.prototype={toggle:function(){var e=this.editor,t=this.isFullState();e.fireEvent("beforefullscreenchange",!t),this.update(!t),t?this.revert():this.enlarge(),e.fireEvent("afterfullscreenchange",!t),"true"===e.body.contentEditable&&e.fireEvent("fullscreenchanged",!t),e.fireEvent("selectionchange")},enlarge:function(){this.saveSataus(),this.setDocumentStatus(),this.resize()},revert:function(){var e=this.editor.options,t=/%$/.test(e.initialFrameHeight)?"100%":e.initialFrameHeight-this.getStyleValue("padding-top")-this.getStyleValue("padding-bottom")-this.getStyleValue("border-width");$.IE6&&this.getEditorHolder().style.setExpression("height","this.scrollHeight <= "+t+' ? "'+t+'px" : "auto"'),this.revertContainerStatus(),this.revertContentAreaStatus(),this.revertDocumentStatus()},update:function(e){this.editor._edui_fullscreen_status=e},resize:function(){var e,t,n,i,o=null,r=0,a=this.editor,s=null;this.isFullState()&&(t=(o=$(window)).width(),e=o.height(),s=this.getEditorHolder(),n=parseInt(domUtils.getComputedStyle(s,"border-width"),10)||0,n+=parseInt(domUtils.getComputedStyle(a.container,"border-width"),10)||0,r+=parseInt(domUtils.getComputedStyle(s,"padding-left"),10)+parseInt(domUtils.getComputedStyle(s,"padding-right"),10)||0,$.IE6&&s.style.setExpression("height",null),i=this.getBound(),$(a.container).css({width:t+"px",height:e+"px",position:$.IE6?"absolute":"fixed",top:i.top,left:i.left,margin:0,padding:0,overflowX:"hidden",overflowY:"hidden"}),$(s).css({width:t-2*n-r+"px",height:e-2*n-(a.options.withoutToolbar?0:$(".edui-toolbar",a.container).outerHeight())-$(".edui-bottombar",a.container).outerHeight()+"px",overflowX:"hidden",overflowY:"auto"}))},saveSataus:function(){for(var e,t=this.editor.container.style,n={},i=0,o=GE.length;i<o;i++)n[e=GE[i]]=t[e];FE[this.editor.uid]=n,this.saveContentAreaStatus(),this.saveDocumentStatus()},saveContentAreaStatus:function(){var e=$(this.getEditorHolder());HE[this.editor.uid]={width:e.css("width"),overflowX:e.css("overflowX"),overflowY:e.css("overflowY"),height:e.css("height")}},saveDocumentStatus:function(){var e=$(this.getEditorDocumentBody());IE[this.editor.uid]={overflowX:e.css("overflowX"),overflowY:e.css("overflowY")},JE[this.editor.uid]={overflowX:$(this.getEditorDocumentElement()).css("overflowX"),overflowY:$(this.getEditorDocumentElement()).css("overflowY")}},revertContainerStatus:function(){$(this.editor.container).css(this.getEditorStatus())},revertContentAreaStatus:function(){var e=this.getEditorHolder(),t=this.getContentAreaStatus();this.supportMin()&&(delete t.height,e.style.height=null),$(e).css(t)},revertDocumentStatus:function(){var e=this.getDocumentStatus();$(this.getEditorDocumentBody()).css("overflowX",e.body.overflowX),$(this.getEditorDocumentElement()).css("overflowY",e.html.overflowY)},setDocumentStatus:function(){$(this.getEditorDocumentBody()).css({overflowX:"hidden",overflowY:"hidden"}),$(this.getEditorDocumentElement()).css({overflowX:"hidden",overflowY:"hidden"})},isFullState:function(){return!!this.editor._edui_fullscreen_status},getEditorStatus:function(){return FE[this.editor.uid]},getContentAreaStatus:function(){return HE[this.editor.uid]},getEditorDocumentElement:function(){return this.editor.container.ownerDocument.documentElement},getEditorDocumentBody:function(){return this.editor.container.ownerDocument.body},getEditorHolder:function(){return this.editor.body},getDocumentStatus:function(){return{body:IE[this.editor.uid],html:JE[this.editor.uid]}},supportMin:function(){var e;return this._support||(e=document.createElement("div"),this._support="minWidth"in e.style),this._support},getBound:function(){var e={html:!0,body:!0},t={top:0,left:0},n=null;return $.IE6&&(n=this.editor.container.offsetParent)&&!e[n.nodeName.toLowerCase()]&&(e=n.getBoundingClientRect(),t.top=-e.top,t.left=-e.left),t},getStyleValue:function(e){return parseInt(domUtils.getComputedStyle(this.getEditorHolder(),e))}},$.extend(LE,{listen:function(){var t=null;LE._hasFullscreenListener||(LE._hasFullscreenListener=!0,$(window).on("resize",function(){null!==t&&(window.clearTimeout(t),t=null),t=window.setTimeout(function(){for(var e in KE)KE[e].resize();t=null},50)}))},getInstance:function(e){return KE[e.uid]||new LE(e),KE[e.uid]}}),LE.listen(),UM.registerUI("link image video map formula",function(i){var o,r,a=this,s={title:a.options.labelMap&&a.options.labelMap[i]||a.getLang("labelMap."+i),url:a.options.UMEDITOR_HOME_URL+"dialogs/"+i+"/"+i+".js"},l=$.eduibutton({icon:i,title:this.getLang("labelMap")[i]||""});return utils.loadFile(document,{src:s.url,tag:"script",type:"text/javascript",defer:"defer"},function(){var e,t,n=UM.getWidgetData(i);n&&(n.buttons&&((e=n.buttons.ok)&&(s.oklabel=e.label||a.getLang("ok"),e.exec&&(s.okFn=function(){return $.proxy(e.exec,null,a,r)()})),(t=n.buttons.cancel)&&(s.cancellabel=t.label||a.getLang("cancel"),t.exec&&(s.cancelFn=function(){return $.proxy(t.exec,null,a,r)()}))),n.width&&(s.width=n.width),n.height&&(s.height=n.height),(r=$.eduimodal(s)).attr("id","edui-dialog-"+i).addClass("edui-dialog-"+i).find(".edui-modal-body").addClass("edui-dialog-"+i+"-body"),r.edui().on("beforehide",function(){var e=a.selection.getRange();e.equals(o)&&e.select()}).on("beforeshow",function(){var e,t,n=this.root();o=a.selection.getRange(),n.parent()[0]||a.$container.find(".edui-dialog-container").append(n),$.IE6&&(e={width:$(window).width(),height:$(window).height()},t=n.parents(".edui-toolbar")[0].getBoundingClientRect(),n.css({position:"absolute",margin:0,left:(e.width-n.width())/2-t.left,top:100-t.top})),UM.setWidgetBody(i,r,a),UM.setTopEditor(a)}).on("afterbackdrop",function(){this.$backdrop.css("zIndex",a.getOpt("zIndex")+1).appendTo(a.$container.find(".edui-dialog-container")),r.css("zIndex",a.getOpt("zIndex")+2)}).on("beforeok",function(){try{o.select()}catch(e){}}).attachTo(l))}),a.addListener("selectionchange",function(){var e=this.queryCommandState(i);l.edui().disabled(-1==e).active(1==e)}),l}),UM.registerUI("emotion formula",function(n){var i=this,o=i.options.UMEDITOR_HOME_URL+"dialogs/"+n+"/"+n+".js",r=$.eduibutton({icon:n,title:this.getLang("labelMap")[n]||""});return utils.loadFile(document,{src:o,tag:"script",type:"text/javascript",defer:"defer"},function(){var e={url:o},t=UM.getWidgetData(n);t.width&&(e.width=t.width),t.height&&(e.height=t.height),$.eduipopup(e).css("zIndex",i.options.zIndex+1).addClass("edui-popup-"+n).edui().on("beforeshow",function(){var e=this.root();e.parent().length||i.$container.find(".edui-dialog-container").append(e),UM.setWidgetBody(n,e,i),UM.setTopEditor(i)}).attachTo(r,{offsetTop:-5,offsetLeft:10,caretLeft:11,caretTop:-8}),i.addListener("selectionchange",function(){var e=this.queryCommandState(n);r.edui().disabled(-1==e).active(1==e)})}),r}),UM.registerUI("imagescale",function(){var s,l=this;l.setOpt("imageScaleEnabled",!0),browser.webkit&&l.getOpt("imageScaleEnabled")&&(l.addListener("click",function(e,t){var n,i,o,r=l.selection.getRange().getClosedNode(),a=t.target;r&&"IMG"==r.tagName&&a==r?(s||(s=$.eduiscale({$wrap:l.$container}).css("zIndex",l.options.zIndex),l.$container.append(s),n=function(){s.edui().hide()},i=function(e){var t=e.target||e.srcElement;t&&-1==t.className.indexOf("edui-scale")&&n()},s.edui().on("aftershow",function(){$(document).bind("keydown",n),$(document).bind("mousedown",i),l.selection.getNative().removeAllRanges()}).on("afterhide",function(){$(document).unbind("keydown",n),$(document).unbind("mousedown",i);var e=s.edui().getScaleTarget();e.parentNode&&l.selection.getRange().selectNode(e).select()}).on("mousedown",function(e){l.selection.getNative().removeAllRanges();var t=e.target||e.srcElement;t&&-1==t.className.indexOf("edui-scale-hand")&&(o=setTimeout(function(){s.edui().hide()},200))}).on("mouseup",function(e){var t=e.target||e.srcElement;t&&-1==t.className.indexOf("edui-scale-hand")&&clearTimeout(o)})),s.edui().show($(r))):s&&"none"!=s.css("display")&&s.edui().hide()}),l.addListener("click",function(e,t){"IMG"==t.target.tagName&&new dom.Range(l.document,l.body).selectNode(t.target).select()}))}),UM.registerUI("autofloat",function(){var h=this,o=h.getLang();h.setOpt({autoFloatEnabled:!0,topOffset:0});var e=!1!==h.options.autoFloatEnabled,f=h.options.topOffset;e&&h.ready(function(){var r=browser.ie&&browser.version<=6,a=browser.quirks;var e,s,l,d=document.createElement("div"),c=!1;function u(){d.parentNode&&d.parentNode.removeChild(d),s.style.cssText=e}function n(){var e,t,n,i=function(e){var t;try{t=e.getBoundingClientRect()}catch(e){t={left:0,top:0,height:0,width:0}}for(var n,i={left:Math.round(t.left),top:Math.round(t.top),height:Math.round(t.bottom-t.top),width:Math.round(t.right-t.left)};(n=e.ownerDocument)!==document&&(e=domUtils.getWindow(n).frameElement);)t=e.getBoundingClientRect(),i.left+=t.left,i.top+=t.top;return i.bottom=i.top+i.height,i.right=i.left+i.width,i}(h.container),o=h.options.toolbarTopOffset||0;i.top<0&&i.bottom-s.offsetHeight>o?c||(e=domUtils.getXY(s),t=domUtils.getComputedStyle(s,"position"),n=domUtils.getComputedStyle(s,"left"),s.style.width=s.offsetWidth+"px",s.style.zIndex=+h.options.zIndex+1,s.parentNode.insertBefore(d,s),r||a&&browser.ie?("absolute"!=s.style.position&&(s.style.position="absolute"),s.style.top=(document.body.scrollTop||document.documentElement.scrollTop)-l+f+"px"):"fixed"!=s.style.position&&(s.style.position="fixed",s.style.top=f+"px","absolute"!=t&&"relative"!=t||!parseFloat(n)||(s.style.left=e.x+"px"))):u()}var t,i=utils.defer(function(){n()},browser.ie?200:100,!0);h.addListener("destroy",function(){$(window).off("scroll resize",n),h.removeListener("keydown",i)}),function(){if(UM.ui)return 1;alert(o.autofloatMsg)}()&&(s=$(".edui-toolbar",h.container)[0],h.addListener("afteruiready",function(){setTimeout(function(){l=$(s).offset().top},100)}),e=s.style.cssText,d.style.height=s.offsetHeight+"px",r&&((t=document.body.style).backgroundImage='url("about:blank")',t.backgroundAttachment="fixed"),$(window).on("scroll resize",n),h.addListener("keydown",i),h.addListener("resize",function(){u(),d.style.height=s.offsetHeight+"px",n()}),h.addListener("beforefullscreenchange",function(e,t){t&&(u(),c=t)}),h.addListener("fullscreenchanged",function(e,t){t||n(),c=t}),h.addListener("sourcemodechanged",function(e,t){setTimeout(function(){n()},0)}),h.addListener("clearDoc",function(){setTimeout(function(){n()},0)}))})}),UM.registerUI("source",function(t){var e=this;e.addListener("fullscreenchanged",function(){e.$container.find("textarea").width(e.$body.width()-10).height(e.$body.height())});var n=$.eduibutton({icon:t,click:function(){e.execCommand(t),UM.setTopEditor(e)},title:this.getLang("labelMap")[t]||""});return this.addListener("selectionchange",function(){var e=this.queryCommandState(t);n.edui().disabled(-1==e).active(1==e)}),n}),UM.registerUI("paragraph fontfamily fontsize",function(i){var n=this,e=n.options.labelMap&&n.options.labelMap[i]||n.getLang("labelMap."+i),t={label:e,title:e,comboboxName:i,items:n.options[i]||[],itemStyles:[],value:[],autowidthitem:[]},o=null,r=null;if(0==t.items.length)return null;switch(i){case"paragraph":t=function(e){var t,n=[];for(t in e.items)e.value.push(t),n.push(t),e.autowidthitem.push(a(t));return e.items=n,e.autoRecord=!1,e}(t);break;case"fontfamily":t=function(e){for(var t=null,n=[],i=0,o=e.items.length;i<o;i++)t=e.items[i].val,n.push(t.split(/\s*,\s*/)[0]),e.itemStyles.push("font-family: "+t),e.value.push(t),e.autowidthitem.push(a(n[i]));return e.items=n,e}(t);break;case"fontsize":t=function(e){var t=null,n=[];e.itemStyles=[],e.value=[];for(var i=0,o=e.items.length;i<o;i++)t=e.items[i],n.push(t),e.itemStyles.push("font-size: "+t+"px");return e.value=e.items,e.items=n,e.autoRecord=!1,e}(t)}return o=$.eduibuttoncombobox(t).css("zIndex",n.getOpt("zIndex")+1),(r=o.edui()).on("comboboxselect",function(e,t){n.execCommand(i,t.value)}).on("beforeshow",function(){0===o.parent().length&&o.appendTo(n.$container.find(".edui-dialog-container")),UM.setTopEditor(n)}),this.addListener("selectionchange",function(e){var t=this.queryCommandState(i),n=this.queryCommandValue(i);r.button().edui().disabled(-1==t).active(1==t),n&&(n=n.replace(/['"]/g,"").toLowerCase().split(/['|"]?\s*,\s*[\1]?/),r.selectItemByLabel(n))}),r.button().addClass("edui-combobox");function a(e,t){var n=$("<span>").html(e).css({display:"inline",position:"absolute",top:-1e7,left:-1e5}).appendTo(document.body),i=n.width();return n.remove(),n=null,i<50?e:(e=e.slice(0,t?-4:-1)).length?a(e+"...",!0):"..."}}),UM.registerUI("forecolor backcolor",function(n){var i=this,e=null,o=null,t=null;return this.addListener("selectionchange",function(){var e=this.queryCommandState(n);t.edui().disabled(-1==e).active(1==e)}),t=$.eduicolorsplitbutton({icon:n,caret:!0,name:n,title:i.getLang("labelMap")[n],click:function(){i.execCommand(n,domUtils.getComputedStyle(o[0],"background-color"))}}),o=t.edui().colorLabel(),e=$.eduicolorpicker({name:n,lang_clearColor:i.getLang("clearColor")||"",lang_themeColor:i.getLang("themeColor")||"",lang_standardColor:i.getLang("standardColor")||""}).on("pickcolor",function(e,t){window.setTimeout(function(){o.css("backgroundColor",t),i.execCommand(n,t)},0)}).on("show",function(){UM.setActiveWidget(colorPickerWidget.root())}).css("zIndex",i.getOpt("zIndex")+1),t.edui().on("arrowclick",function(){e.parent().length||i.$container.find(".edui-dialog-container").append(e),e.edui().show(t,{caretDir:"down",offsetTop:-5,offsetLeft:8,caretLeft:11,caretTop:-8}),UM.setTopEditor(i)}).register("click",t,function(){e.edui().hide()}),t})}(jQuery);